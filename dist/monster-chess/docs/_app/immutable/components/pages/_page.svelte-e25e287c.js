var Pe=Object.defineProperty;var Ae=(i,e,t)=>e in i?Pe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var M=(i,e,t)=>(Ae(i,typeof e!="symbol"?e+"":e,t),t);import{_ as De}from"../../chunks/preload-helper-b21cceae.js";import{S as de,i as pe,s as _e,e as $,b as L,g as we,t as R,d as Te,f as G,h as I,k as P,q as F,l as A,m as C,r as V,n as b,G as W,I as be,J as ee,B as O,o as ke,K as Le,w as We,a as ve,x as Ce,c as Ee,y as Se,z as Ne,L as fe,M as ue,u as xe}from"../../chunks/index-ab6e1620.js";import{b as Be}from"../../chunks/paths-6cd3a76e.js";class N{constructor(e,t){this.x=e,this.y=t}add(e,t){return new N(this.x+e,this.y+t)}addVec(e){return this.add(e.x,e.y)}set(e){this.x=e.x,this.y=e.y}copy(){return new N(this.x,this.y)}equals(e){return this.x===e.x&&this.y===e.y}}class me{constructor(e){this.pieces=e}pieceAt(e){return this.pieces.find(t=>t.position.equals(e))}removePiece(e){const t=this.pieces.indexOf(e);if(t===-1)throw new Error("removePiece run on missing piece.");this.pieces.splice(t,1)}move(e,t){const n=this.pieceAt(t);n!==void 0&&this.removePiece(n);const o=this.pieceAt(e);o.position.set(t),o.type===ie&&o.position.y===(o.color===v.WHITE?0:7)&&(o.type=ye)}copy(){return new me(this.pieces.map(e=>e.copy()))}copyWithMove(e,t){const n=this.copy();return n.move(e,t),n}legalState(e){const t=this.pieces.filter(c=>c.color===v.BLACK),n=this.pieces.filter(c=>c.color===v.WHITE),o=t.find(c=>c.type===J),r=n.find(c=>c.type===J);if(o===void 0||r===void 0)return!1;if(e===v.WHITE){for(const c of t)if(c.moves(this).some(f=>f.equals(r.position)))return!1}else for(const c of n){const f=c.moves(this),l=c.doubleMoves(this,f);if(f.some(a=>a.equals(o.position))||l.some(a=>a.finalPosition.equals(o.position)))return!1}return!0}}class j{}var v=(i=>(i[i.WHITE=0]="WHITE",i[i.BLACK=1]="BLACK",i))(v||{});const Oe=i=>0<=i.x&&i.x<8&&0<=i.y&&i.y<8,He=(i,e,t,n,o,r,c)=>{const f=[];let l=i.add(e,t),a=0;for(;Oe(l)&&a<n;){const s=o.find(d=>d.position.equals(l));if(s!==void 0){c&&s.color!=r&&f.push(l);break}f.push(l),l=l.add(e,t),a++}return f},qe=i=>{const e=[];for(const t of i)e.some(n=>n.x===t.x&&n.y===t.y)||e.push(t);return e},z=(i,e,t,n,o,r,c)=>{let f=[];return[[e,t],[e,-t],[-e,t],[-e,-t],[t,e],[t,-e],[-t,e],[-t,-e]].forEach(a=>{f=f.concat(He(i,...a,n,o,r,c))}),qe(f)};class Ke extends j{constructor(){super(...arguments);M(this,"id","k")}moves(t,n,o){return z(t,1,1,1,n,o,!0).concat(z(t,1,0,1,n,o,!0))}}const J=new Ke;class Re extends j{constructor(){super(...arguments);M(this,"id","r")}moves(t,n,o){return z(t,1,0,1/0,n,o,!0)}}const te=new Re;class Ge extends j{constructor(){super(...arguments);M(this,"id","n")}moves(t,n,o){return z(t,2,1,1,n,o,!0)}}const he=new Ge;class Fe extends j{constructor(){super(...arguments);M(this,"id","b")}moves(t,n,o){return z(t,1,1,1/0,n,o,!0)}}const ne=new Fe;class Ve extends j{constructor(){super(...arguments);M(this,"id","q")}moves(t,n,o){return ne.moves(t,n,o).concat(te.moves(t,n,o))}}const ye=new Ve,Ye=(i,e,t)=>i.filter(n=>e.some(o=>o.position.equals(n)&&o.color!=t));class je extends j{constructor(){super(...arguments);M(this,"id","p")}moves(t,n,o){return He(t,0,o===0?-1:1,t.y===(o===0?6:1)?2:1,n,o,!1).concat(Ye(o===0?[t.add(-1,-1),t.add(1,-1)]:[t.add(-1,1),t.add(1,1)],n,o))}}const ie=new je;class K{constructor(e,t,n){this.type=e,this.color=t,this.position=n}moves(e){return this.type.moves(this.position,e.pieces,this.color)}doubleMoves(e,t,n=!1){const o=t.flatMap(s=>{var H;const d=(H=e.pieceAt(s))==null?void 0:H.position,h=e.copyWithMove(this.position,s);return h.pieceAt(s).moves(h).map(S=>({finalPosition:S,singleMove:s,takes:d}))}),r=[],c=(s,d)=>{s.finalPosition.equals(d.finalPosition)&&s.singleMove.equals(d.singleMove)&&(s.takes===void 0&&d.takes===void 0||s.takes!==void 0&&d.takes!==void 0&&s.takes.equals(d.takes))};o.forEach(s=>{r.some(d=>c(s,d))||r.push(s)});const f=[],l=[];for(const s of r){const d=f.find(h=>h.equals(s.finalPosition));d===void 0?(f.push(s.finalPosition),l.push([s])):l[f.indexOf(d)].push(s)}return(n?l.filter(s=>s.filter(d=>d.takes!==void 0).length<=1):l).flat().filter(s=>!t.some(d=>d.equals(s.finalPosition))).filter(s=>!s.finalPosition.equals(this.position))}copy(){return new K(this.type,this.color,this.position.copy())}}const Xe=(i,e)=>{const t=i.pieces.filter(n=>n.color===e);return console.log(t),t.every(n=>{switch(n.color){case 0:return Je(n,i,e).length===0;case 1:return ze(n,i,e).length===0}})},ze=(i,e,t)=>i.moves(e).filter(n=>e.copyWithMove(i.position,n).legalState(t)),Je=(i,e,t)=>i.doubleMoves(e,i.moves(e)).filter(n=>e.copyWithMove(i.position,n.finalPosition).legalState(t)),ge=[J,te,he,ye,ne,ie];var Y=(i=>(i[i.PLAYING=0]="PLAYING",i[i.ENDED=1]="ENDED",i))(Y||{}),T=(i=>(i[i.WHITE_FIRST=0]="WHITE_FIRST",i[i.WHITE_SECOND=1]="WHITE_SECOND",i[i.BLACK=2]="BLACK",i))(T||{});function Ue(i){const e=i-1;return e*e*e+1}function se(i,{delay:e=0,duration:t=400,easing:n=Ue,start:o=0,opacity:r=0}={}){const c=getComputedStyle(i),f=+c.opacity,l=c.transform==="none"?"":c.transform,a=1-o,s=f*(1-r);return{delay:e,duration:t,easing:n,css:(d,h)=>`
			transform: ${l} scale(${1-a*h});
			opacity: ${f-s*h}
		`}}function Ze(i){let e,t,n,o;return{c(){e=P("div"),t=F("BLACK WINS!"),this.h()},l(r){e=A(r,"DIV",{class:!0});var c=C(e);t=V(c,"BLACK WINS!"),c.forEach(I),this.h()},h(){b(e,"class","overlay black svelte-1hpjhek")},m(r,c){L(r,e,c),W(e,t),o=!0},i(r){o||(be(()=>{n||(n=ee(e,se,{},!0)),n.run(1)}),o=!0)},o(r){n||(n=ee(e,se,{},!1)),n.run(0),o=!1},d(r){r&&I(e),r&&n&&n.end()}}}function Qe(i){let e,t,n,o;return{c(){e=P("div"),t=F("WHITE WINS!"),this.h()},l(r){e=A(r,"DIV",{class:!0});var c=C(e);t=V(c,"WHITE WINS!"),c.forEach(I),this.h()},h(){b(e,"class","overlay white svelte-1hpjhek")},m(r,c){L(r,e,c),W(e,t),o=!0},i(r){o||(be(()=>{n||(n=ee(e,se,{},!0)),n.run(1)}),o=!0)},o(r){n||(n=ee(e,se,{},!1)),n.run(0),o=!1},d(r){r&&I(e),r&&n&&n.end()}}}function $e(i){let e,t,n,o;const r=[Qe,Ze],c=[];function f(l,a){return l[0]===v.WHITE?0:l[0]===v.BLACK?1:-1}return~(e=f(i))&&(t=c[e]=r[e](i)),{c(){t&&t.c(),n=$()},l(l){t&&t.l(l),n=$()},m(l,a){~e&&c[e].m(l,a),L(l,n,a),o=!0},p(l,[a]){let s=e;e=f(l),e!==s&&(t&&(we(),R(c[s],1,1,()=>{c[s]=null}),Te()),~e?(t=c[e],t||(t=c[e]=r[e](l),t.c()),G(t,1),t.m(n.parentNode,n)):t=null)},i(l){o||(G(t),o=!0)},o(l){R(t),o=!1},d(l){~e&&c[e].d(l),l&&I(n)}}}function et(i,e,t){let{winner:n}=e;return i.$$set=o=>{"winner"in o&&t(0,n=o.winner)},[n]}class tt extends de{constructor(e){super(),pe(this,e,et,$e,_e,{winner:0})}}var X=(i=>(i[i.CONNECTING=0]="CONNECTING",i[i.WAITING=1]="WAITING",i[i.CONNECTED=2]="CONNECTED",i[i.DISCONNECTED=3]="DISCONNECTED",i))(X||{}),Me=(i=>(i[i.HOST=0]="HOST",i[i.CLIENT=1]="CLIENT",i))(Me||{});const nt="aydenmc-monster-chess-";class it{constructor(e,t,n,o){M(this,"peer");M(this,"connection");M(this,"status",0);M(this,"type",0);this.peerjs=e,this.room=t,this.onStatusChange=n,this.onMove=o,this.peer=new e.Peer}setStatus(e){this.status=e,this.onStatusChange()}handleData(e,t){const{x1:n,y1:o,x2:r,y2:c,newTurn:f}=t,l=[new N(n,o),new N(r,c)];e.onMove(l,f)}init(){const e=`${nt}${this.room}`;this.onStatusChange(),this.peer.once("open",()=>{this.connection=this.peer.connect(e),this.connection.once("open",()=>{this.type=1,this.setStatus(2)}),this.connection.on("data",t=>this.handleData(this,t))}),this.peer.once("error",t=>{console.log(t.message),this.peer=new this.peerjs.Peer(e),this.peer.once("open",()=>{this.setStatus(1)}),this.peer.on("connection",n=>{this.connection=n,this.type=0,this.setStatus(2),this.connection.on("data",o=>{console.log(o),this.handleData(this,o)})})})}sendMove(e,t){const[n,o]=e,r={x1:n.x,y1:n.y,x2:o.x,y2:o.y,newTurn:t};console.log(`sending ${JSON.stringify(r)}...`),this.connection.send(r)}}function st(i){let e;return{c(){e=P("canvas")},l(t){e=A(t,"CANVAS",{}),C(e).forEach(I)},m(t,n){L(t,e,n),i[7](e)},p:O,i:O,o:O,d(t){t&&I(e),i[7](null)}}}function ot(i,e,t){let{currentTurn:n}=e,{currentGameState:o}=e,{board:r}=e,{interactive:c}=e,{perspective:f}=e;const l=h=>f===v.WHITE?h:7-h;let{onMove:a}=e,s;ke(()=>{const h=window.innerHeight*1.5,u=h/8,H=(p,w)=>{const E=new Image;return E.src=`${Be}/images/${w===v.WHITE?"w":"b"}${p}.png`,E},S=Object.assign({},...ge.map(p=>({[p.id]:H(p.id,v.WHITE)}))),x=Object.assign({},...ge.map(p=>({[p.id]:H(p.id,v.BLACK)}))),U=p=>(p.color===v.WHITE?S:x)[p.type.id];t(0,s.width=h,s),t(0,s.height=h,s);const g=s.getContext("2d");g.fillStyle="#b58863",g.fillRect(0,0,h,h),g.fillStyle="#f0d9b5";for(let p=0;p<8;p++)for(let w=p%2;w<8;w+=2)g.fillRect(p*u,l(w)*u,u,u);const m=(p,w,E,y)=>{g.fillStyle=y,g.beginPath(),g.ellipse(p*u+u/2,w*u+u/2,E,E,0,0,2*Math.PI),g.fill()},D=(p,w,E,y)=>{p.forEach(_=>{m(_.x,l(_.y),u/5,(_.x+_.y)%2==1?"#6e533c":"#92846e"),m(_.x,l(_.y),u/10,(_.x+_.y)%2==1?"#b58863":"#f0d9b5")}),w.forEach(_=>{m(_.x,l(_.y),u/5,(_.x+_.y)%2==1?"#6e533c":"#92846e")}),E.forEach(_=>{g.fillStyle=(_.x+_.y)%2==1?"#6e533c":"#92846e",g.fillRect(_.x*u,l(_.y)*u,u,u),g.fillStyle=(_.x+_.y)%2==1?"#b58863":"#f0d9b5",g.fillRect(_.x*u+u/15,l(_.y)*u+u/15,u-2*u/15,u-2*u/15)}),y.forEach(_=>{g.fillStyle=(_.x+_.y)%2==1?"#6e533c":"#92846e",g.fillRect(_.x*u,l(_.y)*u,u,u)})};let k,B=[],q=[],oe=[],re=[],ce=[],le=[];const Ie=()=>{requestAnimationFrame(Ie),g.fillStyle="#b58863",g.fillRect(0,0,h,h),g.fillStyle="#f0d9b5";for(let p=0;p<8;p++)for(let w=p%2;w<8;w+=2)g.fillRect(p*u,l(w)*u,u,u);k!==void 0&&D(oe,re,ce,le),r.pieces.forEach(p=>{p!==k&&g.drawImage(U(p),p.position.x*u,l(p.position.y)*u,u,u)}),k!==void 0&&g.drawImage(U(k),Z.x-u/2,Z.y-u/2,u,u)};Ie();const Z=new N(0,0),ae=p=>{const w=[],E=[];return p.forEach(y=>{r.pieces.some(_=>_.position.equals(y))?E.push(y):w.push(y)}),[w,E]};s.addEventListener("mousedown",p=>{if(o===Y.PLAYING&&c)if(p.button===0){const w=new N(Math.floor(p.offsetX*(s.width/s.clientWidth)/u),l(Math.floor(p.offsetY*(s.height/s.clientHeight)/u))),E=r.pieceAt(w);E!==void 0&&(E.color===v.WHITE&&(n===T.WHITE_FIRST||n===T.WHITE_SECOND)||E.color===v.BLACK&&n===T.BLACK)&&f===E.color&&(k=E,n===T.WHITE_SECOND||n===T.BLACK?(B=E.moves(r).filter(y=>r.copyWithMove(E.position,y).legalState(n===T.WHITE_FIRST||n===T.WHITE_SECOND?v.WHITE:v.BLACK)),q=[],[re,le]=ae(B),[oe,ce]=[[],[]]):(B=E.moves(r),q=E.doubleMoves(r,B,!0).filter(y=>r.copyWithMove(E.position,y.finalPosition).legalState(n===T.WHITE_FIRST||n===T.WHITE_SECOND?v.WHITE:v.BLACK)),[oe,ce]=ae(B),[re,le]=ae(q.map(y=>y.finalPosition))))}else p.button===2&&(k=void 0)}),s.addEventListener("mouseup",p=>{if(k!==void 0){const w=new N(Math.floor(p.offsetX*(s.width/s.clientWidth)/u),l(Math.floor(p.offsetY*(s.height/s.clientHeight)/u)));if(n===T.WHITE_SECOND||n===T.BLACK){const E=B.find(y=>y.equals(w));E!==void 0&&a([k.position.copy(),E.copy()])}else{const E=B.find(_=>_.equals(w)),y=q.find(_=>_.finalPosition.equals(w));E!==void 0?a([k.position.copy(),E.copy()]):y!==void 0&&(y.takes!==void 0?(a([k.position.copy(),y.takes.copy()]),a([y.takes.copy(),y.finalPosition.copy()])):(a([k.position.copy(),y.singleMove.copy()]),a([y.singleMove.copy(),y.finalPosition.copy()])))}k=void 0}}),s.addEventListener("contextmenu",p=>p.preventDefault()),document.addEventListener("mousemove",p=>{Z.x=p.offsetX*(s.width/s.clientWidth),Z.y=p.offsetY*(s.height/s.clientHeight)})});function d(h){Le[h?"unshift":"push"](()=>{s=h,t(0,s)})}return i.$$set=h=>{"currentTurn"in h&&t(1,n=h.currentTurn),"currentGameState"in h&&t(2,o=h.currentGameState),"board"in h&&t(3,r=h.board),"interactive"in h&&t(4,c=h.interactive),"perspective"in h&&t(5,f=h.perspective),"onMove"in h&&t(6,a=h.onMove)},[s,n,o,r,c,f,a,d]}class rt extends de{constructor(e){super(),pe(this,e,ot,st,_e,{currentTurn:1,currentGameState:2,board:3,interactive:4,perspective:5,onMove:6})}}function ct(i){let e,t,n,o,r,c,f,l;return e=new rt({props:{currentTurn:i[0],currentGameState:i[2],board:i[6],onMove:i[8],interactive:i[1]==0,perspective:i[5]}}),{c(){We(e.$$.fragment),t=ve(),n=P("div"),o=P("div"),r=fe("svg"),c=fe("circle"),f=fe("circle"),this.h()},l(a){Ce(e.$$.fragment,a),t=Ee(a),n=A(a,"DIV",{class:!0});var s=C(n);o=A(s,"DIV",{class:!0});var d=C(o);r=ue(d,"svg",{viewBox:!0});var h=C(r);c=ue(h,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),C(c).forEach(I),f=ue(h,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),C(f).forEach(I),h.forEach(I),d.forEach(I),s.forEach(I),this.h()},h(){b(c,"cx","0.5"),b(c,"cy","0.5"),b(c,"r","0.4"),b(c,"fill","black"),b(f,"cx","0.5"),b(f,"cy","0.5"),b(f,"r",i[7]),b(f,"fill","white"),b(r,"viewBox","0 0 1 1"),b(o,"class","turn-indicator"),b(n,"class","toolbar")},m(a,s){Se(e,a,s),L(a,t,s),L(a,n,s),W(n,o),W(o,r),W(r,c),W(r,f),l=!0},p(a,s){const d={};s&1&&(d.currentTurn=a[0]),s&4&&(d.currentGameState=a[2]),s&64&&(d.board=a[6]),s&2&&(d.interactive=a[1]==0),s&32&&(d.perspective=a[5]),e.$set(d),(!l||s&128)&&b(f,"r",a[7])},i(a){l||(G(e.$$.fragment,a),l=!0)},o(a){R(e.$$.fragment,a),l=!1},d(a){Ne(e,a),a&&I(t),a&&I(n)}}}function lt(i){let e,t,n,o,r,c,f,l=`${Q}#${i[4]}`,a,s;return{c(){e=P("div"),t=P("p"),n=F("Waiting for an opponent..."),o=ve(),r=P("p"),c=F("Send them this link: "),f=P("a"),a=F(l),this.h()},l(d){e=A(d,"DIV",{class:!0});var h=C(e);t=A(h,"P",{});var u=C(t);n=V(u,"Waiting for an opponent..."),u.forEach(I),o=Ee(h),r=A(h,"P",{});var H=C(r);c=V(H,"Send them this link: "),f=A(H,"A",{href:!0});var S=C(f);a=V(S,l),S.forEach(I),H.forEach(I),h.forEach(I),this.h()},h(){b(f,"href",s=Q+"#"+i[4]),b(e,"class","status")},m(d,h){L(d,e,h),W(e,t),W(t,n),W(e,o),W(e,r),W(r,c),W(r,f),W(f,a)},p(d,h){h&16&&l!==(l=`${Q}#${d[4]}`)&&xe(a,l),h&16&&s!==(s=Q+"#"+d[4])&&b(f,"href",s)},i:O,o:O,d(d){d&&I(e)}}}function at(i){let e,t,n;return{c(){e=P("div"),t=P("p"),n=F("Connecting..."),this.h()},l(o){e=A(o,"DIV",{class:!0});var r=C(e);t=A(r,"P",{});var c=C(t);n=V(c,"Connecting..."),c.forEach(I),r.forEach(I),this.h()},h(){b(e,"class","status")},m(o,r){L(o,e,r),W(e,t),W(t,n)},p:O,i:O,o:O,d(o){o&&I(e)}}}function ft(i){let e,t,n,o,r,c;e=new tt({props:{winner:i[2]===Y.ENDED?i[0]===T.WHITE_FIRST||i[0]===T.WHITE_SECOND?v.BLACK:v.WHITE:void 0}});const f=[at,lt,ct],l=[];function a(s,d){return s[3]===X.CONNECTING?0:s[3]===X.WAITING?1:s[3]===X.CONNECTED?2:-1}return~(n=a(i))&&(o=l[n]=f[n](i)),{c(){We(e.$$.fragment),t=ve(),o&&o.c(),r=$()},l(s){Ce(e.$$.fragment,s),t=Ee(s),o&&o.l(s),r=$()},m(s,d){Se(e,s,d),L(s,t,d),~n&&l[n].m(s,d),L(s,r,d),c=!0},p(s,[d]){const h={};d&5&&(h.winner=s[2]===Y.ENDED?s[0]===T.WHITE_FIRST||s[0]===T.WHITE_SECOND?v.BLACK:v.WHITE:void 0),e.$set(h);let u=n;n=a(s),n===u?~n&&l[n].p(s,d):(o&&(we(),R(l[u],1,1,()=>{l[u]=null}),Te()),~n?(o=l[n],o?o.p(s,d):(o=l[n]=f[n](s),o.c()),G(o,1),o.m(r.parentNode,r)):o=null)},i(s){c||(G(e.$$.fragment,s),G(o),c=!0)},o(s){R(e.$$.fragment,s),R(o),c=!1},d(s){Ne(e,s),s&&I(t),~n&&l[n].d(s),s&&I(r)}}}const Q="https://acou12.github.io/monster-chess";function ut(i,e,t){let n,o,r=T.WHITE_FIRST,c=Y.PLAYING,f,l=X.CONNECTING,a;const s=(m,D)=>[...Array(D-m).keys()].map(k=>k+m),d=m=>{Xe(m,r===T.WHITE_FIRST||r===T.WHITE_SECOND?v.WHITE:v.BLACK)&&t(2,c=Y.ENDED)};let h;const u=new me([...s(0,8).map(m=>new K(ie,v.BLACK,new N(m,1))),...[te,he,ne,ye,J,ne,he,te].map((m,D)=>new K(m,v.BLACK,new N(D,0))),...s(2,6).map(m=>new K(ie,v.WHITE,new N(m,6))),new K(J,v.WHITE,new N(4,7))]),H=m=>{let D="";const k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",B=k.length;for(let q=0;q<m;q++)D+=k.charAt(Math.floor(Math.random()*B));return D};ke(async()=>{t(4,a=window.location.hash),a===""?(t(4,a=H(8).toString()),window.location.hash=`#${a}`):t(4,a=a.slice(1)),f=new it(await De(()=>import("../../chunks/bundler-674fefd2.js"),[],import.meta.url),a,()=>{t(3,l=f.status),t(5,h=f.type===Me.CLIENT?v.BLACK:v.WHITE),console.log(h)},g),f.init(),document.addEventListener("keydown",m=>{m.key==="ArrowLeft"&&x<S.length?t(1,x+=1):m.key==="ArrowRight"&&x>0&&t(1,x-=1)})});let S=[],x=0;const U=m=>{g(m,(r+1)%3),f.sendMove(m,r)},g=(m,D)=>{t(9,S=[...S,u.copy()]),u.move(...m),t(0,r=D),d(u)};return i.$$.update=()=>{i.$$.dirty&1&&t(7,n=[.4,.2,0][r]),i.$$.dirty&514&&t(6,o=x==0?u:S[S.length-x])},[r,x,c,l,a,h,o,n,U,S]}class vt extends de{constructor(e){super(),pe(this,e,ut,ft,_e,{})}}export{vt as default};
