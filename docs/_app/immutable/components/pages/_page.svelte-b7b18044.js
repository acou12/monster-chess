var De=Object.defineProperty;var Pe=(i,e,t)=>e in i?De(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var M=(i,e,t)=>(Pe(i,typeof e!="symbol"?e+"":e,t),t);import{_ as Le}from"../../chunks/preload-helper-b21cceae.js";import{S as he,i as de,s as pe,e as Ee,b as P,g as ge,t as q,d as we,f as R,h as g,k as x,q as j,l as B,m as A,r as X,n as b,G as D,I as Te,J as $,B as L,o as be,K as xe,w as ke,a as me,L as le,x as We,c as ye,M as ae,y as Ce,z as Se,u as Be}from"../../chunks/index-ab6e1620.js";import{b as Oe}from"../../chunks/paths-6cd3a76e.js";class C{constructor(e,t){this.x=e,this.y=t}add(e,t){return new C(this.x+e,this.y+t)}addVec(e){return this.add(e.x,e.y)}set(e){this.x=e.x,this.y=e.y}copy(){return new C(this.x,this.y)}equals(e){return this.x===e.x&&this.y===e.y}}class _e{constructor(e){this.pieces=e}pieceAt(e){return this.pieces.find(t=>t.position.equals(e))}removePiece(e){const t=this.pieces.indexOf(e);if(t===-1)throw new Error("removePiece run on missing piece.");this.pieces.splice(t,1)}move(e,t){const n=this.pieceAt(t);n!==void 0&&this.removePiece(n),this.pieceAt(e).position.set(t)}copy(){return new _e(this.pieces.map(e=>e.copy()))}copyWithMove(e,t){const n=this.copy();return n.move(e,t),n}legalState(e){const t=this.pieces.filter(r=>r.color===E.BLACK),n=this.pieces.filter(r=>r.color===E.WHITE),s=t.find(r=>r.type===J),o=n.find(r=>r.type===J);if(s===void 0||o===void 0)return!1;if(e===E.WHITE){for(const r of t)if(r.moves(this).some(u=>u.equals(o.position)))return!1}else for(const r of n){const u=r.moves(this),l=r.doubleMoves(this,u);if(u.some(c=>c.equals(s.position))||l.some(c=>c.finalPosition.equals(s.position)))return!1}return!0}}class F{}var E=(i=>(i[i.WHITE=0]="WHITE",i[i.BLACK=1]="BLACK",i))(E||{});const Ke=i=>0<=i.x&&i.x<8&&0<=i.y&&i.y<8,Ne=(i,e,t,n,s,o,r)=>{const u=[];let l=i.add(e,t),c=0;for(;Ke(l)&&c<n;){const f=s.find(k=>k.position.equals(l));if(f!==void 0){r&&f.color!=o&&u.push(l);break}u.push(l),l=l.add(e,t),c++}return u},qe=i=>{const e=[];for(const t of i)e.some(n=>n.x===t.x&&n.y===t.y)||e.push(t);return e},z=(i,e,t,n,s,o,r)=>{let u=[];return[[e,t],[e,-t],[-e,t],[-e,-t],[t,e],[t,-e],[-t,e],[-t,-e]].forEach(c=>{u=u.concat(Ne(i,...c,n,s,o,r))}),qe(u)};class Re extends F{constructor(){super(...arguments);M(this,"id","k")}moves(t,n,s){return z(t,1,1,1,n,s,!0).concat(z(t,1,0,1,n,s,!0))}}const J=new Re;class Ge extends F{constructor(){super(...arguments);M(this,"id","r")}moves(t,n,s){return z(t,1,0,1/0,n,s,!0)}}const V=new Ge;class Fe extends F{constructor(){super(...arguments);M(this,"id","n")}moves(t,n,s){return z(t,2,1,1,n,s,!0)}}const fe=new Fe;class Ve extends F{constructor(){super(...arguments);M(this,"id","b")}moves(t,n,s){return z(t,1,1,1/0,n,s,!0)}}const ee=new Ve;class Ye extends F{constructor(){super(...arguments);M(this,"id","q")}moves(t,n,s){return ee.moves(t,n,s).concat(V.moves(t,n,s))}}const He=new Ye,je=(i,e,t)=>i.filter(n=>e.some(s=>s.position.equals(n)&&s.color!=t));class Xe extends F{constructor(){super(...arguments);M(this,"id","p")}moves(t,n,s){return Ne(t,0,s===0?-1:1,t.y===(s===0?6:1)?2:1,n,s,!1).concat(je(s===0?[t.add(-1,-1),t.add(1,-1)]:[t.add(-1,1),t.add(1,1)],n,s))}}const ue=new Xe;class K{constructor(e,t,n){this.type=e,this.color=t,this.position=n}moves(e){return this.type.moves(this.position,e.pieces,this.color)}doubleMoves(e,t,n=!1){const s=t.flatMap(c=>{var a;const f=(a=e.pieceAt(c))==null?void 0:a.position,k=e.copyWithMove(this.position,c);return k.pieceAt(c).moves(k).map(W=>({finalPosition:W,takes:f}))}),o=[];s.forEach(c=>{o.some(f=>c.finalPosition.equals(f.finalPosition)&&(c.takes===void 0&&f.takes===void 0||c.takes!==void 0&&f.takes!==void 0&&c.takes.equals(f.takes)))||o.push(c)});const r=[],u=[];for(const c of o){const f=r.find(k=>k.equals(c.finalPosition));f===void 0?(r.push(c.finalPosition),u.push([c])):u[r.indexOf(f)].push(c)}return(n?u.filter(c=>c.filter(f=>f.takes!==void 0).length<=1):u).flat().filter(c=>!t.some(f=>f.equals(c.finalPosition))).filter(c=>!c.finalPosition.equals(this.position))}copy(){return new K(this.type,this.color,this.position.copy())}}const ze=(i,e)=>{const t=i.pieces.filter(n=>n.color===e);return console.log(t),t.every(n=>{switch(n.color){case 0:return Ue(n,i,e).length===0;case 1:return Je(n,i,e).length===0}})},Je=(i,e,t)=>i.moves(e).filter(n=>e.copyWithMove(i.position,n).legalState(t)),Ue=(i,e,t)=>i.doubleMoves(e,i.moves(e)).filter(n=>e.copyWithMove(i.position,n.finalPosition).legalState(t)),Ie=[J,V,fe,He,ee,ue];var G=(i=>(i[i.PLAYING=0]="PLAYING",i[i.ENDED=1]="ENDED",i))(G||{}),w=(i=>(i[i.WHITE_FIRST=0]="WHITE_FIRST",i[i.WHITE_SECOND=1]="WHITE_SECOND",i[i.BLACK=2]="BLACK",i))(w||{});function Ze(i){const e=i-1;return e*e*e+1}function te(i,{delay:e=0,duration:t=400,easing:n=Ze,start:s=0,opacity:o=0}={}){const r=getComputedStyle(i),u=+r.opacity,l=r.transform==="none"?"":r.transform,c=1-s,f=u*(1-o);return{delay:e,duration:t,easing:n,css:(k,v)=>`
			transform: ${l} scale(${1-c*v});
			opacity: ${u-f*v}
		`}}function Qe(i){let e,t,n,s;return{c(){e=x("div"),t=j("BLACK WINS!"),this.h()},l(o){e=B(o,"DIV",{class:!0});var r=A(e);t=X(r,"BLACK WINS!"),r.forEach(g),this.h()},h(){b(e,"class","overlay black svelte-1hpjhek")},m(o,r){P(o,e,r),D(e,t),s=!0},i(o){s||(Te(()=>{n||(n=$(e,te,{},!0)),n.run(1)}),s=!0)},o(o){n||(n=$(e,te,{},!1)),n.run(0),s=!1},d(o){o&&g(e),o&&n&&n.end()}}}function $e(i){let e,t,n,s;return{c(){e=x("div"),t=j("WHITE WINS!"),this.h()},l(o){e=B(o,"DIV",{class:!0});var r=A(e);t=X(r,"WHITE WINS!"),r.forEach(g),this.h()},h(){b(e,"class","overlay white svelte-1hpjhek")},m(o,r){P(o,e,r),D(e,t),s=!0},i(o){s||(Te(()=>{n||(n=$(e,te,{},!0)),n.run(1)}),s=!0)},o(o){n||(n=$(e,te,{},!1)),n.run(0),s=!1},d(o){o&&g(e),o&&n&&n.end()}}}function et(i){let e,t,n,s;const o=[$e,Qe],r=[];function u(l,c){return l[0]===E.WHITE?0:l[0]===E.BLACK?1:-1}return~(e=u(i))&&(t=r[e]=o[e](i)),{c(){t&&t.c(),n=Ee()},l(l){t&&t.l(l),n=Ee()},m(l,c){~e&&r[e].m(l,c),P(l,n,c),s=!0},p(l,[c]){let f=e;e=u(l),e!==f&&(t&&(ge(),q(r[f],1,1,()=>{r[f]=null}),we()),~e?(t=r[e],t||(t=r[e]=o[e](l),t.c()),R(t,1),t.m(n.parentNode,n)):t=null)},i(l){s||(R(t),s=!0)},o(l){q(t),s=!1},d(l){~e&&r[e].d(l),l&&g(n)}}}function tt(i,e,t){let{winner:n}=e;return i.$$set=s=>{"winner"in s&&t(0,n=s.winner)},[n]}class nt extends he{constructor(e){super(),de(this,e,tt,et,pe,{winner:0})}}var Y=(i=>(i[i.CONNECTING=0]="CONNECTING",i[i.WAITING=1]="WAITING",i[i.CONNECTED=2]="CONNECTED",i[i.DISCONNECTED=3]="DISCONNECTED",i))(Y||{}),Me=(i=>(i[i.HOST=0]="HOST",i[i.CLIENT=1]="CLIENT",i))(Me||{});const it="aydenmc-monster-chess-";class st{constructor(e,t,n,s){M(this,"peer");M(this,"connection");M(this,"status",0);M(this,"type",0);this.peerjs=e,this.room=t,this.onStatusChange=n,this.onMove=s,this.peer=new e.Peer}setStatus(e){this.status=e,this.onStatusChange()}handleData(e,t){const{x1:n,y1:s,x2:o,y2:r,newTurn:u}=t,l=[new C(n,s),new C(o,r)];e.onMove(l,u)}init(){const e=`${it}${this.room}`;this.onStatusChange(),this.peer.once("open",()=>{this.connection=this.peer.connect(e),this.connection.once("open",()=>{this.type=1,this.setStatus(2)}),this.connection.on("data",t=>this.handleData(this,t))}),this.peer.once("error",t=>{console.log(t.message),this.peer=new this.peerjs.Peer(e),this.peer.once("open",()=>{this.setStatus(1)}),this.peer.on("connection",n=>{this.connection=n,this.type=0,this.setStatus(2),this.connection.on("data",s=>{console.log(s),this.handleData(this,s)})})})}sendMove(e,t){const[n,s]=e,o={x1:n.x,y1:n.y,x2:s.x,y2:s.y,newTurn:t};console.log(`sending ${JSON.stringify(o)}...`),this.connection.send(o)}}function ot(i){let e;return{c(){e=x("canvas")},l(t){e=B(t,"CANVAS",{}),A(e).forEach(g)},m(t,n){P(t,e,n),i[7](e)},p:L,i:L,o:L,d(t){t&&g(e),i[7](null)}}}function rt(i,e,t){let{currentTurn:n}=e,{currentGameState:s}=e,{board:o}=e,{interactive:r}=e,{perspective:u}=e;const l=v=>u===E.WHITE?v:7-v;let{onMove:c}=e,f;be(()=>{const v=window.innerHeight*1.5,a=v/8,W=(p,I)=>{const m=new Image;return m.src=`${Oe}/images/${I===E.WHITE?"w":"b"}${p}.png`,m},d=Object.assign({},...Ie.map(p=>({[p.id]:W(p.id,E.WHITE)}))),T=Object.assign({},...Ie.map(p=>({[p.id]:W(p.id,E.BLACK)}))),N=p=>(p.color===E.WHITE?d:T)[p.type.id];t(0,f.width=v,f),t(0,f.height=v,f);const h=f.getContext("2d");h.fillStyle="#b58863",h.fillRect(0,0,v,v),h.fillStyle="#f0d9b5";for(let p=0;p<8;p++)for(let I=p%2;I<8;I+=2)h.fillRect(p*a,l(I)*a,a,a);const H=(p,I,m,y)=>{h.fillStyle=y,h.beginPath(),h.ellipse(p*a+a/2,I*a+a/2,m,m,0,0,2*Math.PI),h.fill()},ne=(p,I,m,y)=>{p.forEach(_=>{H(_.x,l(_.y),a/5,(_.x+_.y)%2==1?"#6e533c":"#92846e"),H(_.x,l(_.y),a/10,(_.x+_.y)%2==1?"#b58863":"#f0d9b5")}),I.forEach(_=>{H(_.x,l(_.y),a/5,(_.x+_.y)%2==1?"#6e533c":"#92846e")}),m.forEach(_=>{h.fillStyle=(_.x+_.y)%2==1?"#6e533c":"#92846e",h.fillRect(_.x*a,l(_.y)*a,a,a),h.fillStyle=(_.x+_.y)%2==1?"#b58863":"#f0d9b5",h.fillRect(_.x*a+a/15,l(_.y)*a+a/15,a-2*a/15,a-2*a/15)}),y.forEach(_=>{h.fillStyle=(_.x+_.y)%2==1?"#6e533c":"#92846e",h.fillRect(_.x*a,l(_.y)*a,a,a)})};let S,O=[],U=[],ie=[],se=[],oe=[],re=[];const ve=()=>{requestAnimationFrame(ve),h.fillStyle="#b58863",h.fillRect(0,0,v,v),h.fillStyle="#f0d9b5";for(let p=0;p<8;p++)for(let I=p%2;I<8;I+=2)h.fillRect(p*a,l(I)*a,a,a);S!==void 0&&ne(ie,se,oe,re),o.pieces.forEach(p=>{p!==S&&h.drawImage(N(p),p.position.x*a,l(p.position.y)*a,a,a)}),S!==void 0&&h.drawImage(N(S),Z.x-a/2,Z.y-a/2,a,a)};ve();const Z=new C(0,0),ce=p=>{const I=[],m=[];return p.forEach(y=>{o.pieces.some(_=>_.position.equals(y))?m.push(y):I.push(y)}),[I,m]};f.addEventListener("mousedown",p=>{if(!!r&&s===G.PLAYING)if(p.button===0){const I=new C(Math.floor(p.offsetX*(f.width/f.clientWidth)/a),l(Math.floor(p.offsetY*(f.height/f.clientHeight)/a))),m=o.pieceAt(I);m!==void 0&&(m.color===E.WHITE&&(n===w.WHITE_FIRST||n===w.WHITE_SECOND)||m.color===E.BLACK&&n===w.BLACK)&&(S=m,n===w.WHITE_SECOND||n===w.BLACK?(O=m.moves(o).filter(y=>o.copyWithMove(m.position,y).legalState(n===w.WHITE_FIRST||n===w.WHITE_SECOND?E.WHITE:E.BLACK)),U=[],[se,re]=ce(O),[ie,oe]=[[],[]]):(O=m.moves(o),U=m.doubleMoves(o,O,!0).filter(y=>o.copyWithMove(m.position,y.finalPosition).legalState(n===w.WHITE_FIRST||n===w.WHITE_SECOND?E.WHITE:E.BLACK)),[ie,oe]=ce(O),[se,re]=ce(U.map(y=>y.finalPosition))))}else p.button===2&&(S=void 0)}),f.addEventListener("mouseup",p=>{if(S!==void 0){const I=new C(Math.floor(p.offsetX*(f.width/f.clientWidth)/a),l(Math.floor(p.offsetY*(f.height/f.clientHeight)/a)));if(n===w.WHITE_SECOND||n===w.BLACK){const m=O.find(y=>y.equals(I));if(m!==void 0){const y=[S.position.copy(),m.copy()];c(y,1)}}else{const m=O.find(_=>_.equals(I)),y=U.find(_=>_.finalPosition.equals(I));if(m!==void 0){const _=[S.position.copy(),m.copy()];c(_,1)}else if(y!==void 0)if(y.takes!==void 0){const _=[S.position.copy(),y.takes.copy()];c(_,1);const Ae=[y.takes.copy(),y.finalPosition.copy()];c(Ae,1)}else{const _=[S.position.copy(),y.finalPosition.copy()];c(_,2)}}S=void 0}}),f.addEventListener("contextmenu",p=>p.preventDefault()),document.addEventListener("mousemove",p=>{Z.x=p.offsetX*(f.width/f.clientWidth),Z.y=p.offsetY*(f.height/f.clientHeight)})});function k(v){xe[v?"unshift":"push"](()=>{f=v,t(0,f)})}return i.$$set=v=>{"currentTurn"in v&&t(1,n=v.currentTurn),"currentGameState"in v&&t(2,s=v.currentGameState),"board"in v&&t(3,o=v.board),"interactive"in v&&t(4,r=v.interactive),"perspective"in v&&t(5,u=v.perspective),"onMove"in v&&t(6,c=v.onMove)},[f,n,s,o,r,u,c,k]}class ct extends he{constructor(e){super(),de(this,e,rt,ot,pe,{currentTurn:1,currentGameState:2,board:3,interactive:4,perspective:5,onMove:6})}}function lt(i){let e,t;return e=new ct({props:{currentTurn:i[0],currentGameState:i[2],board:i[6],onMove:i[8],interactive:i[1]==0,perspective:i[5]}}),{c(){ke(e.$$.fragment)},l(n){We(e.$$.fragment,n)},m(n,s){Ce(e,n,s),t=!0},p(n,s){const o={};s&1&&(o.currentTurn=n[0]),s&4&&(o.currentGameState=n[2]),s&64&&(o.board=n[6]),s&2&&(o.interactive=n[1]==0),s&32&&(o.perspective=n[5]),e.$set(o)},i(n){t||(R(e.$$.fragment,n),t=!0)},o(n){q(e.$$.fragment,n),t=!1},d(n){Se(e,n)}}}function at(i){let e,t,n,s=`${Q}#${i[4]}`,o,r;return{c(){e=x("div"),t=j("Waiting for opponent... Send them this link: "),n=x("a"),o=j(s),this.h()},l(u){e=B(u,"DIV",{class:!0});var l=A(e);t=X(l,"Waiting for opponent... Send them this link: "),n=B(l,"A",{href:!0});var c=A(n);o=X(c,s),c.forEach(g),l.forEach(g),this.h()},h(){b(n,"href",r=Q+"#"+i[4]),b(e,"class","status")},m(u,l){P(u,e,l),D(e,t),D(e,n),D(n,o)},p(u,l){l&16&&s!==(s=`${Q}#${u[4]}`)&&Be(o,s),l&16&&r!==(r=Q+"#"+u[4])&&b(n,"href",r)},i:L,o:L,d(u){u&&g(e)}}}function ft(i){let e,t;return{c(){e=x("div"),t=j("Connecting..."),this.h()},l(n){e=B(n,"DIV",{class:!0});var s=A(e);t=X(s,"Connecting..."),s.forEach(g),this.h()},h(){b(e,"class","status")},m(n,s){P(n,e,s),D(e,t)},p:L,i:L,o:L,d(n){n&&g(e)}}}function ut(i){let e,t,n,s,o,r,u,l,c,f,k;e=new nt({props:{winner:i[2]===G.ENDED?i[0]===w.WHITE_FIRST||i[0]===w.WHITE_SECOND?E.BLACK:E.WHITE:void 0}});const v=[ft,at,lt],a=[];function W(d,T){return d[3]===Y.CONNECTING?0:d[3]===Y.WAITING?1:d[3]===Y.CONNECTED?2:-1}return~(n=W(i))&&(s=a[n]=v[n](i)),{c(){ke(e.$$.fragment),t=me(),s&&s.c(),o=me(),r=x("div"),u=x("div"),l=le("svg"),c=le("circle"),f=le("circle"),this.h()},l(d){We(e.$$.fragment,d),t=ye(d),s&&s.l(d),o=ye(d),r=B(d,"DIV",{class:!0});var T=A(r);u=B(T,"DIV",{class:!0});var N=A(u);l=ae(N,"svg",{viewBox:!0});var h=A(l);c=ae(h,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),A(c).forEach(g),f=ae(h,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),A(f).forEach(g),h.forEach(g),N.forEach(g),T.forEach(g),this.h()},h(){b(c,"cx","0.5"),b(c,"cy","0.5"),b(c,"r","0.4"),b(c,"fill","black"),b(f,"cx","0.5"),b(f,"cy","0.5"),b(f,"r",i[7]),b(f,"fill","white"),b(l,"viewBox","0 0 1 1"),b(u,"class","turn-indicator"),b(r,"class","toolbar")},m(d,T){Ce(e,d,T),P(d,t,T),~n&&a[n].m(d,T),P(d,o,T),P(d,r,T),D(r,u),D(u,l),D(l,c),D(l,f),k=!0},p(d,[T]){const N={};T&5&&(N.winner=d[2]===G.ENDED?d[0]===w.WHITE_FIRST||d[0]===w.WHITE_SECOND?E.BLACK:E.WHITE:void 0),e.$set(N);let h=n;n=W(d),n===h?~n&&a[n].p(d,T):(s&&(ge(),q(a[h],1,1,()=>{a[h]=null}),we()),~n?(s=a[n],s?s.p(d,T):(s=a[n]=v[n](d),s.c()),R(s,1),s.m(o.parentNode,o)):s=null),(!k||T&128)&&b(f,"r",d[7])},i(d){k||(R(e.$$.fragment,d),R(s),k=!0)},o(d){q(e.$$.fragment,d),q(s),k=!1},d(d){Se(e,d),d&&g(t),~n&&a[n].d(d),d&&g(o),d&&g(r)}}}const Q="https://acou12.github.io/monster-chess";function ht(i,e,t){let n,s,o=w.WHITE_FIRST,r=G.PLAYING,u,l=Y.CONNECTING,c;const f=(h,H)=>[...Array(H-h).keys()].map(ne=>ne+h),k=h=>{ze(h,o===w.WHITE_FIRST||o===w.WHITE_SECOND?E.WHITE:E.BLACK)&&t(2,r=G.ENDED)};let v;const a=new _e([...f(0,8).map(h=>new K(ue,E.BLACK,new C(h,1))),...[V,fe,ee,He,J,ee,fe,V].map((h,H)=>new K(h,E.BLACK,new C(H,0))),...f(2,6).map(h=>new K(ue,E.WHITE,new C(h,6))),new K(J,E.WHITE,new C(4,7)),new K(V,E.WHITE,new C(5,7))]);be(async()=>{t(4,c=window.location.hash),c===""?t(4,c=Math.floor(Math.random()*1e6).toString(16)):t(4,c=c.slice(1)),u=new st(await Le(()=>import("../../chunks/bundler-674fefd2.js"),[],import.meta.url),c,()=>{t(3,l=u.status),t(5,v=u.type===Me.CLIENT?E.BLACK:E.WHITE),console.log(v)},N),u.init(),document.addEventListener("keydown",h=>{h.key==="ArrowLeft"&&d<W.length?t(1,d+=1):h.key==="ArrowRight"&&d>0&&t(1,d-=1)})});let W=[],d=0;const T=(h,H)=>{N(h,(o+H)%3),u.sendMove(h,o)},N=(h,H)=>{t(9,W=[...W,a.copy()]),a.move(...h),t(0,o=H),k(a)};return i.$$.update=()=>{i.$$.dirty&1&&t(7,n=[.4,.2,0][o]),i.$$.dirty&514&&t(6,s=d==0?a:W[W.length-d])},[o,d,r,l,c,v,s,n,T,W]}class Et extends he{constructor(e){super(),de(this,e,ht,ut,pe,{})}}export{Et as default};
