var U=Object.defineProperty;var G=(o,t,s)=>t in o?U(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var w=(o,t,s)=>(G(o,typeof t!="symbol"?t+"":t,s),s);import{S as ee,i as se,s as te,k as ne,l as ie,m as oe,h as X,b as le,B as P,o as ce,I as ae}from"../../chunks/index-51ea2bd7.js";import{b as fe}from"../../chunks/paths-6cd3a76e.js";class T{constructor(t,s){this.x=t,this.y=s}add(t,s){return new T(this.x+t,this.y+s)}addVec(t){return this.add(t.x,t.y)}equals(t){return this.x===t.x&&this.y===t.y}}class S{}var p=(o=>(o[o.WHITE=0]="WHITE",o[o.BLACK=1]="BLACK",o))(p||{});const ue=o=>0<=o.x&&o.x<8&&0<=o.y&&o.y<8,j=(o,t,s,l,a,u,n)=>{const h=[];let E=o.add(t,s),x=0;for(;ue(E)&&x<l;){const m=a.find(f=>f.position.equals(E));if(m!==void 0){n&&m.color!=u&&h.push(E);break}h.push(E),E=E.add(t,s),x++}return h},Z=o=>{const t=[];for(const s of o)t.some(l=>l.x===s.x&&l.y===s.y)||t.push(s);return t},_=(o,t,s,l,a,u,n)=>{let h=[];return[[t,s],[t,-s],[-t,s],[-t,-s],[s,t],[s,-t],[-s,t],[-s,-t]].forEach(x=>{h=h.concat(j(o,...x,l,a,u,n))}),Z(h)},re=(o,t)=>{const s=o.type.moves(o.position,t,o.color),l=Z(s.flatMap(u=>o.type.moves(u,t,o.color)));let a=[];for(const u of l)s.some(n=>u.equals(n))||a.push(u);return{single:s,double:a.filter(u=>!u.equals(o.position))}};class de extends S{constructor(){super(...arguments);w(this,"id","k")}moves(s,l,a){return _(s,1,1,1,l,a,!0).concat(_(s,1,0,1,l,a,!0))}}const F=new de;class pe extends S{constructor(){super(...arguments);w(this,"id","r")}moves(s,l,a){return _(s,1,0,1/0,l,a,!0)}}const q=new pe;class he extends S{constructor(){super(...arguments);w(this,"id","n")}moves(s,l,a){return _(s,2,1,1,l,a,!0)}}const D=new he;class ye extends S{constructor(){super(...arguments);w(this,"id","b")}moves(s,l,a){return _(s,1,1,1/0,l,a,!0)}}const R=new ye;class Ie extends S{constructor(){super(...arguments);w(this,"id","q")}moves(s,l,a){return R.moves(s,l,a).concat(q.moves(s,l,a))}}const Q=new Ie,Ee=(o,t,s)=>o.filter(l=>t.some(a=>a.position.equals(l)&&a.color!=s));class ge extends S{constructor(){super(...arguments);w(this,"id","p")}moves(s,l,a){return j(s,0,a===0?-1:1,s.y===(a===0?6:1)?2:1,l,a,!1).concat(Ee(a===0?[s.add(-1,-1),s.add(1,-1)]:[s.add(-1,1),s.add(1,1)],l,a))}}const O=new ge;class k{constructor(t,s,l){this.type=t,this.color=s,this.position=l}}const Y=[F,q,D,Q,R,O];function Te(o){let t;return{c(){t=ne("canvas")},l(s){t=ie(s,"CANVAS",{}),oe(t).forEach(X)},m(s,l){le(s,t,l),o[1](t)},p:P,i:P,o:P,d(s){s&&X(t),o[1](null)}}}function be(o,t,s){let l;ce(()=>{const u=window.innerHeight,n=u/8,h=(e,c)=>{const i=new Image;return i.src=`${fe}/images/${c===p.WHITE?"w":"b"}${e}.png`,i},E=Object.assign({},...Y.map(e=>({[e.id]:h(e.id,p.WHITE)}))),x=Object.assign({},...Y.map(e=>({[e.id]:h(e.id,p.BLACK)}))),m=e=>(e.color===p.WHITE?E:x)[e.type.id];s(0,l.width=u,l),s(0,l.height=u,l);const f=l.getContext("2d");f.fillStyle="#b58863",f.fillRect(0,0,u,u),f.fillStyle="#f0d9b5";for(let e=0;e<8;e++)for(let c=e%2;c<8;c+=2)f.fillRect(e*n,c*n,n,n);const M=(e,c,i,r)=>{f.fillStyle=r,f.beginPath(),f.ellipse(e*n+n/2,c*n+n/2,i,i,0,0,2*Math.PI),f.fill()},$=(e,c)=>{e.forEach(i=>{M(i.x,i.y,n/5,(i.x+i.y)%2==1?"#6e533c":"#92846e"),I==y.WHITE_FIRST&&M(i.x,i.y,n/10,(i.x+i.y)%2==1?"#b58863":"#f0d9b5")}),I==y.WHITE_FIRST&&c.forEach(i=>{M(i.x,i.y,n/5,(i.x+i.y)%2==1?"#6e533c":"#92846e")})},z=(e,c)=>{e.forEach(i=>{I==y.WHITE_FIRST?(f.fillStyle=(i.x+i.y)%2==1?"#6e533c":"#92846e",f.fillRect(i.x*n,i.y*n,n,n),f.fillStyle=(i.x+i.y)%2==1?"#b58863":"#f0d9b5",f.fillRect(i.x*n+n/15,i.y*n+n/15,n-2*n/15,n-2*n/15)):(f.fillStyle=(i.x+i.y)%2==1?"#6e533c":"#92846e",f.fillRect(i.x*n,i.y*n,n,n))}),I==y.WHITE_FIRST&&c.forEach(i=>{f.fillStyle=(i.x+i.y)%2==1?"#6e533c":"#92846e",f.fillRect(i.x*n,i.y*n,n,n)})},v=(e,c)=>[...Array(c-e).keys()].map(i=>i+e),b=[...v(0,8).map(e=>new k(O,p.BLACK,new T(e,1))),...[q,D,R,Q,F,R,D,q].map((e,c)=>new k(e,p.BLACK,new T(c,0))),...v(2,6).map(e=>new k(O,p.WHITE,new T(e,6))),new k(F,p.WHITE,new T(4,7))];let d,A,L,B,C,y;(function(e){e[e.WHITE_FIRST=0]="WHITE_FIRST",e[e.WHITE_SECOND=1]="WHITE_SECOND",e[e.BLACK=2]="BLACK"})(y||(y={}));let I=y.WHITE_FIRST;const N=()=>{requestAnimationFrame(N),f.fillStyle="#b58863",f.fillRect(0,0,u,u),f.fillStyle="#f0d9b5";for(let e=0;e<8;e++)for(let c=e%2;c<8;c+=2)f.fillRect(e*n,c*n,n,n);d!==void 0&&($(A,L),z(B,C)),b.forEach(e=>{e!==d&&f.drawImage(m(e),e.position.x*n,e.position.y*n,n,n)}),d!==void 0&&f.drawImage(m(d),H.x-n/2,H.y-n/2,n,n)};N();const H=new T(0,0),V=e=>{const c=[],i=[];return e.forEach(r=>{b.some(W=>W.position.equals(r))?i.push(r):c.push(r)}),[c,i]};l.addEventListener("mousedown",e=>{if(e.button===0){const c=new T(Math.floor(e.offsetX/n),Math.floor(e.offsetY/n)),i=b.find(r=>r.position.equals(c));if(i!==void 0&&(i.color===p.WHITE&&(I===y.WHITE_FIRST||I===y.WHITE_SECOND)||i.color===p.BLACK&&I===y.BLACK)){d=i;const r=re(d,b);[A,B]=V(r.single),[L,C]=V(r.double)}}else e.button===2&&(d=void 0)}),l.addEventListener("mouseup",e=>{if(d!==void 0){const c=new T(Math.floor(e.offsetX/n),Math.floor(e.offsetY/n)),i=A.some(g=>g.equals(c)),r=L.some(g=>g.equals(c)),W=B.some(g=>g.equals(c)),K=C.some(g=>g.equals(c));if(!c.equals(d.position)&&(i||r||W||K)){if(d.position,W||K){const g=b.find(J=>J.position.equals(c));b.splice(b.indexOf(g),1)}d.position=c,I++,(r||K)&&I++,I%=3}d=void 0}}),l.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("mousemove",e=>{H.x=e.offsetX,H.y=e.offsetY}),document.addEventListener("keydown",e=>{})});function a(u){ae[u?"unshift":"push"](()=>{l=u,s(0,l)})}return[l,a]}class me extends ee{constructor(t){super(),se(this,t,be,Te,te,{})}}export{me as default};
