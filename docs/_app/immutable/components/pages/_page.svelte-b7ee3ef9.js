var $=Object.defineProperty;var G=(o,t,s)=>t in o?$(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var x=(o,t,s)=>(G(o,typeof t!="symbol"?t+"":t,s),s);import{S as ee,i as se,s as te,k as ne,l as ie,m as oe,h as X,b as le,B as P,o as ce,I as ae}from"../../chunks/index-51ea2bd7.js";class T{constructor(t,s){this.x=t,this.y=s}add(t,s){return new T(this.x+t,this.y+s)}addVec(t){return this.add(t.x,t.y)}equals(t){return this.x===t.x&&this.y===t.y}}class S{}var p=(o=>(o[o.WHITE=0]="WHITE",o[o.BLACK=1]="BLACK",o))(p||{});const ue=o=>0<=o.x&&o.x<8&&0<=o.y&&o.y<8,j=(o,t,s,l,a,f,n)=>{const h=[];let E=o.add(t,s),b=0;for(;ue(E)&&b<l;){const m=a.find(u=>u.position.equals(E));if(m!==void 0){n&&m.color!=f&&h.push(E);break}h.push(E),E=E.add(t,s),b++}return h},Z=o=>{const t=[];for(const s of o)t.some(l=>l.x===s.x&&l.y===s.y)||t.push(s);return t},_=(o,t,s,l,a,f,n)=>{let h=[];return[[t,s],[t,-s],[-t,s],[-t,-s],[s,t],[s,-t],[-s,t],[-s,-t]].forEach(b=>{h=h.concat(j(o,...b,l,a,f,n))}),Z(h)},fe=(o,t)=>{const s=o.type.moves(o.position,t,o.color),l=Z(s.flatMap(f=>o.type.moves(f,t,o.color)));let a=[];for(const f of l)s.some(n=>f.equals(n))||a.push(f);return{single:s,double:a.filter(f=>!f.equals(o.position))}};class re extends S{constructor(){super(...arguments);x(this,"id","k")}moves(s,l,a){return _(s,1,1,1,l,a,!0).concat(_(s,1,0,1,l,a,!0))}}const F=new re;class de extends S{constructor(){super(...arguments);x(this,"id","r")}moves(s,l,a){return _(s,1,0,1/0,l,a,!0)}}const q=new de;class pe extends S{constructor(){super(...arguments);x(this,"id","n")}moves(s,l,a){return _(s,2,1,1,l,a,!0)}}const D=new pe;class he extends S{constructor(){super(...arguments);x(this,"id","b")}moves(s,l,a){return _(s,1,1,1/0,l,a,!0)}}const R=new he;class ye extends S{constructor(){super(...arguments);x(this,"id","q")}moves(s,l,a){return R.moves(s,l,a).concat(q.moves(s,l,a))}}const Q=new ye,Ie=(o,t,s)=>o.filter(l=>t.some(a=>a.position.equals(l)&&a.color!=s));class Ee extends S{constructor(){super(...arguments);x(this,"id","p")}moves(s,l,a){return j(s,0,a===0?-1:1,s.y===(a===0?6:1)?2:1,l,a,!1).concat(Ie(a===0?[s.add(-1,-1),s.add(1,-1)]:[s.add(-1,1),s.add(1,1)],l,a))}}const O=new Ee;class k{constructor(t,s,l){this.type=t,this.color=s,this.position=l}}const Y=[F,q,D,Q,R,O];function ge(o){let t;return{c(){t=ne("canvas")},l(s){t=ie(s,"CANVAS",{}),oe(t).forEach(X)},m(s,l){le(s,t,l),o[1](t)},p:P,i:P,o:P,d(s){s&&X(t),o[1](null)}}}function Te(o,t,s){let l;ce(()=>{const f=window.innerHeight,n=f/8,h=(e,c)=>{const i=new Image;return i.src=`/images/${c===p.WHITE?"w":"b"}${e}.png`,i},E=Object.assign({},...Y.map(e=>({[e.id]:h(e.id,p.WHITE)}))),b=Object.assign({},...Y.map(e=>({[e.id]:h(e.id,p.BLACK)}))),m=e=>(e.color===p.WHITE?E:b)[e.type.id];s(0,l.width=f,l),s(0,l.height=f,l);const u=l.getContext("2d");u.fillStyle="#b58863",u.fillRect(0,0,f,f),u.fillStyle="#f0d9b5";for(let e=0;e<8;e++)for(let c=e%2;c<8;c+=2)u.fillRect(e*n,c*n,n,n);const M=(e,c,i,r)=>{u.fillStyle=r,u.beginPath(),u.ellipse(e*n+n/2,c*n+n/2,i,i,0,0,2*Math.PI),u.fill()},z=(e,c)=>{e.forEach(i=>{M(i.x,i.y,n/5,(i.x+i.y)%2==1?"#6e533c":"#92846e"),I==y.WHITE_FIRST&&M(i.x,i.y,n/10,(i.x+i.y)%2==1?"#b58863":"#f0d9b5")}),I==y.WHITE_FIRST&&c.forEach(i=>{M(i.x,i.y,n/5,(i.x+i.y)%2==1?"#6e533c":"#92846e")})},J=(e,c)=>{e.forEach(i=>{I==y.WHITE_FIRST?(u.fillStyle=(i.x+i.y)%2==1?"#6e533c":"#92846e",u.fillRect(i.x*n,i.y*n,n,n),u.fillStyle=(i.x+i.y)%2==1?"#b58863":"#f0d9b5",u.fillRect(i.x*n+n/15,i.y*n+n/15,n-2*n/15,n-2*n/15)):(u.fillStyle=(i.x+i.y)%2==1?"#6e533c":"#92846e",u.fillRect(i.x*n,i.y*n,n,n))}),I==y.WHITE_FIRST&&c.forEach(i=>{u.fillStyle=(i.x+i.y)%2==1?"#6e533c":"#92846e",u.fillRect(i.x*n,i.y*n,n,n)})},v=(e,c)=>[...Array(c-e).keys()].map(i=>i+e),w=[...v(0,8).map(e=>new k(O,p.BLACK,new T(e,1))),...[q,D,R,Q,F,R,D,q].map((e,c)=>new k(e,p.BLACK,new T(c,0))),...v(2,6).map(e=>new k(O,p.WHITE,new T(e,6))),new k(F,p.WHITE,new T(4,7))];let d,A,L,B,C,y;(function(e){e[e.WHITE_FIRST=0]="WHITE_FIRST",e[e.WHITE_SECOND=1]="WHITE_SECOND",e[e.BLACK=2]="BLACK"})(y||(y={}));let I=y.WHITE_FIRST;const N=()=>{requestAnimationFrame(N),u.fillStyle="#b58863",u.fillRect(0,0,f,f),u.fillStyle="#f0d9b5";for(let e=0;e<8;e++)for(let c=e%2;c<8;c+=2)u.fillRect(e*n,c*n,n,n);d!==void 0&&(z(A,L),J(B,C)),w.forEach(e=>{e!==d&&u.drawImage(m(e),e.position.x*n,e.position.y*n,n,n)}),d!==void 0&&u.drawImage(m(d),H.x-n/2,H.y-n/2,n,n)};N();const H=new T(0,0),V=e=>{const c=[],i=[];return e.forEach(r=>{w.some(W=>W.position.equals(r))?i.push(r):c.push(r)}),[c,i]};l.addEventListener("mousedown",e=>{if(e.button===0){const c=new T(Math.floor(e.offsetX/n),Math.floor(e.offsetY/n)),i=w.find(r=>r.position.equals(c));if(i!==void 0&&(i.color===p.WHITE&&(I===y.WHITE_FIRST||I===y.WHITE_SECOND)||i.color===p.BLACK&&I===y.BLACK)){d=i;const r=fe(d,w);[A,B]=V(r.single),[L,C]=V(r.double)}}else e.button===2&&(d=void 0)}),l.addEventListener("mouseup",e=>{if(d!==void 0){const c=new T(Math.floor(e.offsetX/n),Math.floor(e.offsetY/n)),i=A.some(g=>g.equals(c)),r=L.some(g=>g.equals(c)),W=B.some(g=>g.equals(c)),K=C.some(g=>g.equals(c));if(!c.equals(d.position)&&(i||r||W||K)){if(d.position,W||K){const g=w.find(U=>U.position.equals(c));w.splice(w.indexOf(g),1)}d.position=c,I++,(r||K)&&I++,I%=3}d=void 0}}),l.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("mousemove",e=>{H.x=e.offsetX,H.y=e.offsetY}),document.addEventListener("keydown",e=>{})});function a(f){ae[f?"unshift":"push"](()=>{l=f,s(0,l)})}return[l,a]}class be extends ee{constructor(t){super(),se(this,t,Te,ge,te,{})}}export{be as default};
