var Pe=Object.defineProperty;var De=(s,e,t)=>e in s?Pe(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var M=(s,e,t)=>(De(s,typeof e!="symbol"?e+"":e,t),t);import{_ as Le}from"../../chunks/preload-helper-b21cceae.js";import{S as de,i as pe,s as _e,e as ee,b as L,g as ge,t as R,d as we,f as G,h as I,k as A,q as F,l as P,m as C,r as V,n as b,G as W,I as Te,J as te,B as O,o as be,K as xe,w as ke,a as ve,x as We,c as Ee,y as Ce,z as Se,L as ae,M as fe,u as Be}from"../../chunks/index-ab6e1620.js";import{b as Oe}from"../../chunks/paths-6cd3a76e.js";class S{constructor(e,t){this.x=e,this.y=t}add(e,t){return new S(this.x+e,this.y+t)}addVec(e){return this.add(e.x,e.y)}set(e){this.x=e.x,this.y=e.y}copy(){return new S(this.x,this.y)}equals(e){return this.x===e.x&&this.y===e.y}}class me{constructor(e){this.pieces=e}pieceAt(e){return this.pieces.find(t=>t.position.equals(e))}removePiece(e){const t=this.pieces.indexOf(e);if(t===-1)throw new Error("removePiece run on missing piece.");this.pieces.splice(t,1)}move(e,t){const n=this.pieceAt(t);n!==void 0&&this.removePiece(n),this.pieceAt(e).position.set(t)}copy(){return new me(this.pieces.map(e=>e.copy()))}copyWithMove(e,t){const n=this.copy();return n.move(e,t),n}legalState(e){const t=this.pieces.filter(l=>l.color===v.BLACK),n=this.pieces.filter(l=>l.color===v.WHITE),i=t.find(l=>l.type===U),r=n.find(l=>l.type===U);if(i===void 0||r===void 0)return!1;if(e===v.WHITE){for(const l of t)if(l.moves(this).some(u=>u.equals(r.position)))return!1}else for(const l of n){const u=l.moves(this),a=l.doubleMoves(this,u);if(u.some(c=>c.equals(i.position))||a.some(c=>c.finalPosition.equals(i.position)))return!1}return!0}}class j{}var v=(s=>(s[s.WHITE=0]="WHITE",s[s.BLACK=1]="BLACK",s))(v||{});const Ke=s=>0<=s.x&&s.x<8&&0<=s.y&&s.y<8,Ne=(s,e,t,n,i,r,l)=>{const u=[];let a=s.add(e,t),c=0;for(;Ke(a)&&c<n;){const o=i.find(p=>p.position.equals(a));if(o!==void 0){l&&o.color!=r&&u.push(a);break}u.push(a),a=a.add(e,t),c++}return u},qe=s=>{const e=[];for(const t of s)e.some(n=>n.x===t.x&&n.y===t.y)||e.push(t);return e},J=(s,e,t,n,i,r,l)=>{let u=[];return[[e,t],[e,-t],[-e,t],[-e,-t],[t,e],[t,-e],[-t,e],[-t,-e]].forEach(c=>{u=u.concat(Ne(s,...c,n,i,r,l))}),qe(u)};class Re extends j{constructor(){super(...arguments);M(this,"id","k")}moves(t,n,i){return J(t,1,1,1,n,i,!0).concat(J(t,1,0,1,n,i,!0))}}const U=new Re;class Ge extends j{constructor(){super(...arguments);M(this,"id","r")}moves(t,n,i){return J(t,1,0,1/0,n,i,!0)}}const X=new Ge;class Fe extends j{constructor(){super(...arguments);M(this,"id","n")}moves(t,n,i){return J(t,2,1,1,n,i,!0)}}const ue=new Fe;class Ve extends j{constructor(){super(...arguments);M(this,"id","b")}moves(t,n,i){return J(t,1,1,1/0,n,i,!0)}}const ne=new Ve;class Ye extends j{constructor(){super(...arguments);M(this,"id","q")}moves(t,n,i){return ne.moves(t,n,i).concat(X.moves(t,n,i))}}const He=new Ye,je=(s,e,t)=>s.filter(n=>e.some(i=>i.position.equals(n)&&i.color!=t));class Xe extends j{constructor(){super(...arguments);M(this,"id","p")}moves(t,n,i){return Ne(t,0,i===0?-1:1,t.y===(i===0?6:1)?2:1,n,i,!1).concat(je(i===0?[t.add(-1,-1),t.add(1,-1)]:[t.add(-1,1),t.add(1,1)],n,i))}}const he=new Xe;class q{constructor(e,t,n){this.type=e,this.color=t,this.position=n}moves(e){return this.type.moves(this.position,e.pieces,this.color)}doubleMoves(e,t,n=!1){const i=t.flatMap(c=>{var f;const o=(f=e.pieceAt(c))==null?void 0:f.position,p=e.copyWithMove(this.position,c);return p.pieceAt(c).moves(p).map(D=>({finalPosition:D,takes:o}))}),r=[];i.forEach(c=>{r.some(o=>c.finalPosition.equals(o.finalPosition)&&(c.takes===void 0&&o.takes===void 0||c.takes!==void 0&&o.takes!==void 0&&c.takes.equals(o.takes)))||r.push(c)});const l=[],u=[];for(const c of r){const o=l.find(p=>p.equals(c.finalPosition));o===void 0?(l.push(c.finalPosition),u.push([c])):u[l.indexOf(o)].push(c)}return(n?u.filter(c=>c.filter(o=>o.takes!==void 0).length<=1):u).flat().filter(c=>!t.some(o=>o.equals(c.finalPosition))).filter(c=>!c.finalPosition.equals(this.position))}copy(){return new q(this.type,this.color,this.position.copy())}}const ze=(s,e)=>{const t=s.pieces.filter(n=>n.color===e);return console.log(t),t.every(n=>{switch(n.color){case 0:return Ue(n,s,e).length===0;case 1:return Je(n,s,e).length===0}})},Je=(s,e,t)=>s.moves(e).filter(n=>e.copyWithMove(s.position,n).legalState(t)),Ue=(s,e,t)=>s.doubleMoves(e,s.moves(e)).filter(n=>e.copyWithMove(s.position,n.finalPosition).legalState(t)),Ie=[U,X,ue,He,ne,he];var Y=(s=>(s[s.PLAYING=0]="PLAYING",s[s.ENDED=1]="ENDED",s))(Y||{}),T=(s=>(s[s.WHITE_FIRST=0]="WHITE_FIRST",s[s.WHITE_SECOND=1]="WHITE_SECOND",s[s.BLACK=2]="BLACK",s))(T||{});function Ze(s){const e=s-1;return e*e*e+1}function se(s,{delay:e=0,duration:t=400,easing:n=Ze,start:i=0,opacity:r=0}={}){const l=getComputedStyle(s),u=+l.opacity,a=l.transform==="none"?"":l.transform,c=1-i,o=u*(1-r);return{delay:e,duration:t,easing:n,css:(p,h)=>`
			transform: ${a} scale(${1-c*h});
			opacity: ${u-o*h}
		`}}function Qe(s){let e,t,n,i;return{c(){e=A("div"),t=F("BLACK WINS!"),this.h()},l(r){e=P(r,"DIV",{class:!0});var l=C(e);t=V(l,"BLACK WINS!"),l.forEach(I),this.h()},h(){b(e,"class","overlay black svelte-1hpjhek")},m(r,l){L(r,e,l),W(e,t),i=!0},i(r){i||(Te(()=>{n||(n=te(e,se,{},!0)),n.run(1)}),i=!0)},o(r){n||(n=te(e,se,{},!1)),n.run(0),i=!1},d(r){r&&I(e),r&&n&&n.end()}}}function $e(s){let e,t,n,i;return{c(){e=A("div"),t=F("WHITE WINS!"),this.h()},l(r){e=P(r,"DIV",{class:!0});var l=C(e);t=V(l,"WHITE WINS!"),l.forEach(I),this.h()},h(){b(e,"class","overlay white svelte-1hpjhek")},m(r,l){L(r,e,l),W(e,t),i=!0},i(r){i||(Te(()=>{n||(n=te(e,se,{},!0)),n.run(1)}),i=!0)},o(r){n||(n=te(e,se,{},!1)),n.run(0),i=!1},d(r){r&&I(e),r&&n&&n.end()}}}function et(s){let e,t,n,i;const r=[$e,Qe],l=[];function u(a,c){return a[0]===v.WHITE?0:a[0]===v.BLACK?1:-1}return~(e=u(s))&&(t=l[e]=r[e](s)),{c(){t&&t.c(),n=ee()},l(a){t&&t.l(a),n=ee()},m(a,c){~e&&l[e].m(a,c),L(a,n,c),i=!0},p(a,[c]){let o=e;e=u(a),e!==o&&(t&&(ge(),R(l[o],1,1,()=>{l[o]=null}),we()),~e?(t=l[e],t||(t=l[e]=r[e](a),t.c()),G(t,1),t.m(n.parentNode,n)):t=null)},i(a){i||(G(t),i=!0)},o(a){R(t),i=!1},d(a){~e&&l[e].d(a),a&&I(n)}}}function tt(s,e,t){let{winner:n}=e;return s.$$set=i=>{"winner"in i&&t(0,n=i.winner)},[n]}class nt extends de{constructor(e){super(),pe(this,e,tt,et,_e,{winner:0})}}var z=(s=>(s[s.CONNECTING=0]="CONNECTING",s[s.WAITING=1]="WAITING",s[s.CONNECTED=2]="CONNECTED",s[s.DISCONNECTED=3]="DISCONNECTED",s))(z||{}),Me=(s=>(s[s.HOST=0]="HOST",s[s.CLIENT=1]="CLIENT",s))(Me||{});const st="aydenmc-monster-chess-";class it{constructor(e,t,n,i){M(this,"peer");M(this,"connection");M(this,"status",0);M(this,"type",0);this.peerjs=e,this.room=t,this.onStatusChange=n,this.onMove=i,this.peer=new e.Peer}setStatus(e){this.status=e,this.onStatusChange()}handleData(e,t){const{x1:n,y1:i,x2:r,y2:l,newTurn:u}=t,a=[new S(n,i),new S(r,l)];e.onMove(a,u)}init(){const e=`${st}${this.room}`;this.onStatusChange(),this.peer.once("open",()=>{this.connection=this.peer.connect(e),this.connection.once("open",()=>{this.type=1,this.setStatus(2)}),this.connection.on("data",t=>this.handleData(this,t))}),this.peer.once("error",t=>{console.log(t.message),this.peer=new this.peerjs.Peer(e),this.peer.once("open",()=>{this.setStatus(1)}),this.peer.on("connection",n=>{this.connection=n,this.type=0,this.setStatus(2),this.connection.on("data",i=>{console.log(i),this.handleData(this,i)})})})}sendMove(e,t){const[n,i]=e,r={x1:n.x,y1:n.y,x2:i.x,y2:i.y,newTurn:t};console.log(`sending ${JSON.stringify(r)}...`),this.connection.send(r)}}function ot(s){let e;return{c(){e=A("canvas")},l(t){e=P(t,"CANVAS",{}),C(e).forEach(I)},m(t,n){L(t,e,n),s[7](e)},p:O,i:O,o:O,d(t){t&&I(e),s[7](null)}}}function rt(s,e,t){let{currentTurn:n}=e,{currentGameState:i}=e,{board:r}=e,{interactive:l}=e,{perspective:u}=e;const a=h=>u===v.WHITE?h:7-h;let{onMove:c}=e,o;be(()=>{const h=window.innerHeight*1.5,f=h/8,D=(d,w)=>{const E=new Image;return E.src=`${Oe}/images/${w===v.WHITE?"w":"b"}${d}.png`,E},H=Object.assign({},...Ie.map(d=>({[d.id]:D(d.id,v.WHITE)}))),x=Object.assign({},...Ie.map(d=>({[d.id]:D(d.id,v.BLACK)}))),Z=d=>(d.color===v.WHITE?H:x)[d.type.id];t(0,o.width=h,o),t(0,o.height=h,o);const g=o.getContext("2d");g.fillStyle="#b58863",g.fillRect(0,0,h,h),g.fillStyle="#f0d9b5";for(let d=0;d<8;d++)for(let w=d%2;w<8;w+=2)g.fillRect(d*f,a(w)*f,f,f);const m=(d,w,E,y)=>{g.fillStyle=y,g.beginPath(),g.ellipse(d*f+f/2,w*f+f/2,E,E,0,0,2*Math.PI),g.fill()},N=(d,w,E,y)=>{d.forEach(_=>{m(_.x,a(_.y),f/5,(_.x+_.y)%2==1?"#6e533c":"#92846e"),m(_.x,a(_.y),f/10,(_.x+_.y)%2==1?"#b58863":"#f0d9b5")}),w.forEach(_=>{m(_.x,a(_.y),f/5,(_.x+_.y)%2==1?"#6e533c":"#92846e")}),E.forEach(_=>{g.fillStyle=(_.x+_.y)%2==1?"#6e533c":"#92846e",g.fillRect(_.x*f,a(_.y)*f,f,f),g.fillStyle=(_.x+_.y)%2==1?"#b58863":"#f0d9b5",g.fillRect(_.x*f+f/15,a(_.y)*f+f/15,f-2*f/15,f-2*f/15)}),y.forEach(_=>{g.fillStyle=(_.x+_.y)%2==1?"#6e533c":"#92846e",g.fillRect(_.x*f,a(_.y)*f,f,f)})};let k,B=[],K=[],ie=[],oe=[],re=[],ce=[];const ye=()=>{requestAnimationFrame(ye),g.fillStyle="#b58863",g.fillRect(0,0,h,h),g.fillStyle="#f0d9b5";for(let d=0;d<8;d++)for(let w=d%2;w<8;w+=2)g.fillRect(d*f,a(w)*f,f,f);k!==void 0&&N(ie,oe,re,ce),r.pieces.forEach(d=>{d!==k&&g.drawImage(Z(d),d.position.x*f,a(d.position.y)*f,f,f)}),k!==void 0&&g.drawImage(Z(k),Q.x-f/2,Q.y-f/2,f,f)};ye();const Q=new S(0,0),le=d=>{const w=[],E=[];return d.forEach(y=>{r.pieces.some(_=>_.position.equals(y))?E.push(y):w.push(y)}),[w,E]};o.addEventListener("mousedown",d=>{if(i===Y.PLAYING&&l)if(d.button===0){const w=new S(Math.floor(d.offsetX*(o.width/o.clientWidth)/f),a(Math.floor(d.offsetY*(o.height/o.clientHeight)/f))),E=r.pieceAt(w);E!==void 0&&(E.color===v.WHITE&&(n===T.WHITE_FIRST||n===T.WHITE_SECOND)||E.color===v.BLACK&&n===T.BLACK)&&u===E.color&&(k=E,n===T.WHITE_SECOND||n===T.BLACK?(B=E.moves(r).filter(y=>r.copyWithMove(E.position,y).legalState(n===T.WHITE_FIRST||n===T.WHITE_SECOND?v.WHITE:v.BLACK)),K=[],[oe,ce]=le(B),[ie,re]=[[],[]]):(B=E.moves(r),K=E.doubleMoves(r,B,!0).filter(y=>r.copyWithMove(E.position,y.finalPosition).legalState(n===T.WHITE_FIRST||n===T.WHITE_SECOND?v.WHITE:v.BLACK)),[ie,re]=le(B),[oe,ce]=le(K.map(y=>y.finalPosition))))}else d.button===2&&(k=void 0)}),o.addEventListener("mouseup",d=>{if(k!==void 0){const w=new S(Math.floor(d.offsetX*(o.width/o.clientWidth)/f),a(Math.floor(d.offsetY*(o.height/o.clientHeight)/f)));if(n===T.WHITE_SECOND||n===T.BLACK){const E=B.find(y=>y.equals(w));if(E!==void 0){const y=[k.position.copy(),E.copy()];c(y,1)}}else{const E=B.find(_=>_.equals(w)),y=K.find(_=>_.finalPosition.equals(w));if(E!==void 0){const _=[k.position.copy(),E.copy()];c(_,1)}else if(y!==void 0)if(y.takes!==void 0){const _=[k.position.copy(),y.takes.copy()];c(_,1);const Ae=[y.takes.copy(),y.finalPosition.copy()];c(Ae,1)}else{const _=[k.position.copy(),y.finalPosition.copy()];c(_,2)}}k=void 0}}),o.addEventListener("contextmenu",d=>d.preventDefault()),document.addEventListener("mousemove",d=>{Q.x=d.offsetX*(o.width/o.clientWidth),Q.y=d.offsetY*(o.height/o.clientHeight)})});function p(h){xe[h?"unshift":"push"](()=>{o=h,t(0,o)})}return s.$$set=h=>{"currentTurn"in h&&t(1,n=h.currentTurn),"currentGameState"in h&&t(2,i=h.currentGameState),"board"in h&&t(3,r=h.board),"interactive"in h&&t(4,l=h.interactive),"perspective"in h&&t(5,u=h.perspective),"onMove"in h&&t(6,c=h.onMove)},[o,n,i,r,l,u,c,p]}class ct extends de{constructor(e){super(),pe(this,e,rt,ot,_e,{currentTurn:1,currentGameState:2,board:3,interactive:4,perspective:5,onMove:6})}}function lt(s){let e,t,n,i,r,l,u,a;return e=new ct({props:{currentTurn:s[0],currentGameState:s[2],board:s[6],onMove:s[8],interactive:s[1]==0,perspective:s[5]}}),{c(){ke(e.$$.fragment),t=ve(),n=A("div"),i=A("div"),r=ae("svg"),l=ae("circle"),u=ae("circle"),this.h()},l(c){We(e.$$.fragment,c),t=Ee(c),n=P(c,"DIV",{class:!0});var o=C(n);i=P(o,"DIV",{class:!0});var p=C(i);r=fe(p,"svg",{viewBox:!0});var h=C(r);l=fe(h,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),C(l).forEach(I),u=fe(h,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),C(u).forEach(I),h.forEach(I),p.forEach(I),o.forEach(I),this.h()},h(){b(l,"cx","0.5"),b(l,"cy","0.5"),b(l,"r","0.4"),b(l,"fill","black"),b(u,"cx","0.5"),b(u,"cy","0.5"),b(u,"r",s[7]),b(u,"fill","white"),b(r,"viewBox","0 0 1 1"),b(i,"class","turn-indicator"),b(n,"class","toolbar")},m(c,o){Ce(e,c,o),L(c,t,o),L(c,n,o),W(n,i),W(i,r),W(r,l),W(r,u),a=!0},p(c,o){const p={};o&1&&(p.currentTurn=c[0]),o&4&&(p.currentGameState=c[2]),o&64&&(p.board=c[6]),o&2&&(p.interactive=c[1]==0),o&32&&(p.perspective=c[5]),e.$set(p),(!a||o&128)&&b(u,"r",c[7])},i(c){a||(G(e.$$.fragment,c),a=!0)},o(c){R(e.$$.fragment,c),a=!1},d(c){Se(e,c),c&&I(t),c&&I(n)}}}function at(s){let e,t,n,i,r,l,u,a=`${$}#${s[4]}`,c,o;return{c(){e=A("div"),t=A("p"),n=F("Waiting for an opponent..."),i=ve(),r=A("p"),l=F("Send them this link: "),u=A("a"),c=F(a),this.h()},l(p){e=P(p,"DIV",{class:!0});var h=C(e);t=P(h,"P",{});var f=C(t);n=V(f,"Waiting for an opponent..."),f.forEach(I),i=Ee(h),r=P(h,"P",{});var D=C(r);l=V(D,"Send them this link: "),u=P(D,"A",{href:!0});var H=C(u);c=V(H,a),H.forEach(I),D.forEach(I),h.forEach(I),this.h()},h(){b(u,"href",o=$+"#"+s[4]),b(e,"class","status")},m(p,h){L(p,e,h),W(e,t),W(t,n),W(e,i),W(e,r),W(r,l),W(r,u),W(u,c)},p(p,h){h&16&&a!==(a=`${$}#${p[4]}`)&&Be(c,a),h&16&&o!==(o=$+"#"+p[4])&&b(u,"href",o)},i:O,o:O,d(p){p&&I(e)}}}function ft(s){let e,t,n;return{c(){e=A("div"),t=A("p"),n=F("Connecting..."),this.h()},l(i){e=P(i,"DIV",{class:!0});var r=C(e);t=P(r,"P",{});var l=C(t);n=V(l,"Connecting..."),l.forEach(I),r.forEach(I),this.h()},h(){b(e,"class","status")},m(i,r){L(i,e,r),W(e,t),W(t,n)},p:O,i:O,o:O,d(i){i&&I(e)}}}function ut(s){let e,t,n,i,r,l;e=new nt({props:{winner:s[2]===Y.ENDED?s[0]===T.WHITE_FIRST||s[0]===T.WHITE_SECOND?v.BLACK:v.WHITE:void 0}});const u=[ft,at,lt],a=[];function c(o,p){return o[3]===z.CONNECTING?0:o[3]===z.WAITING?1:o[3]===z.CONNECTED?2:-1}return~(n=c(s))&&(i=a[n]=u[n](s)),{c(){ke(e.$$.fragment),t=ve(),i&&i.c(),r=ee()},l(o){We(e.$$.fragment,o),t=Ee(o),i&&i.l(o),r=ee()},m(o,p){Ce(e,o,p),L(o,t,p),~n&&a[n].m(o,p),L(o,r,p),l=!0},p(o,[p]){const h={};p&5&&(h.winner=o[2]===Y.ENDED?o[0]===T.WHITE_FIRST||o[0]===T.WHITE_SECOND?v.BLACK:v.WHITE:void 0),e.$set(h);let f=n;n=c(o),n===f?~n&&a[n].p(o,p):(i&&(ge(),R(a[f],1,1,()=>{a[f]=null}),we()),~n?(i=a[n],i?i.p(o,p):(i=a[n]=u[n](o),i.c()),G(i,1),i.m(r.parentNode,r)):i=null)},i(o){l||(G(e.$$.fragment,o),G(i),l=!0)},o(o){R(e.$$.fragment,o),R(i),l=!1},d(o){Se(e,o),o&&I(t),~n&&a[n].d(o),o&&I(r)}}}const $="https://acou12.github.io/monster-chess";function ht(s,e,t){let n,i,r=T.WHITE_FIRST,l=Y.PLAYING,u,a=z.CONNECTING,c;const o=(m,N)=>[...Array(N-m).keys()].map(k=>k+m),p=m=>{ze(m,r===T.WHITE_FIRST||r===T.WHITE_SECOND?v.WHITE:v.BLACK)&&t(2,l=Y.ENDED)};let h;const f=new me([...o(0,8).map(m=>new q(he,v.BLACK,new S(m,1))),...[X,ue,ne,He,U,ne,ue,X].map((m,N)=>new q(m,v.BLACK,new S(N,0))),...o(2,6).map(m=>new q(he,v.WHITE,new S(m,6))),new q(U,v.WHITE,new S(4,7)),new q(X,v.WHITE,new S(5,7))]),D=m=>{let N="";const k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",B=k.length;for(let K=0;K<m;K++)N+=k.charAt(Math.floor(Math.random()*B));return N};be(async()=>{t(4,c=window.location.hash),c===""?(t(4,c=D(8).toString()),window.location.hash=`#${c}`):t(4,c=c.slice(1)),u=new it(await Le(()=>import("../../chunks/bundler-674fefd2.js"),[],import.meta.url),c,()=>{t(3,a=u.status),t(5,h=u.type===Me.CLIENT?v.BLACK:v.WHITE),console.log(h)},g),u.init(),document.addEventListener("keydown",m=>{m.key==="ArrowLeft"&&x<H.length?t(1,x+=1):m.key==="ArrowRight"&&x>0&&t(1,x-=1)})});let H=[],x=0;const Z=(m,N)=>{g(m,(r+N)%3),u.sendMove(m,r)},g=(m,N)=>{t(9,H=[...H,f.copy()]),f.move(...m),t(0,r=N),p(f)};return s.$$.update=()=>{s.$$.dirty&1&&t(7,n=[.4,.2,0][r]),s.$$.dirty&514&&t(6,i=x==0?f:H[H.length-x])},[r,x,l,a,c,h,i,n,Z,H]}class Et extends de{constructor(e){super(),pe(this,e,ht,ut,_e,{})}}export{Et as default};
