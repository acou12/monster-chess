var ke=Object.defineProperty;var Te=(i,e,t)=>e in i?ke(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var C=(i,e,t)=>(Te(i,typeof e!="symbol"?e+"":e,t),t);import{S as Ae,i as Pe,s as Se,k as M,a as G,e as pe,l as q,m as x,h as A,c as Z,b as K,B as he,o as We,I as He,J as ie,K as ne,L as O,n as w,G as W,M as H,N as ce,O as Me,P as ge}from"../../chunks/index-b11b2e29.js";import{b as D}from"../../chunks/paths-6cd3a76e.js";class S{constructor(e,t){this.x=e,this.y=t}add(e,t){return new S(this.x+e,this.y+t)}addVec(e){return this.add(e.x,e.y)}set(e){this.x=e.x,this.y=e.y}copy(){return new S(this.x,this.y)}equals(e){return this.x===e.x&&this.y===e.y}}class re{constructor(e){this.pieces=e}pieceAt(e){return this.pieces.find(t=>t.position.equals(e))}removePiece(e){const t=this.pieces.indexOf(e);if(t===-1)throw new Error("removePiece run on missing piece.");this.pieces.splice(t,1)}move(e,t){const o=this.pieceAt(t);o!==void 0&&this.removePiece(o),this.pieceAt(e).position.set(t)}copy(){return new re(this.pieces.map(e=>e.copy()))}copyWithMove(e,t){const o=this.copy();return o.move(e,t),o}legalState(e){const t=this.pieces.filter(n=>n.color===I.BLACK),o=this.pieces.filter(n=>n.color===I.WHITE),l=t.find(n=>n.type===Y),a=o.find(n=>n.type===Y);if(l===void 0||a===void 0)return!1;if(e===I.WHITE){for(const n of t)if(n.moves(this).some(s=>s.equals(a.position)))return!1}else for(const n of o){const s=n.moves(this),c=n.doubleMoves(this,s);if(s.some(m=>m.equals(l.position))||c.some(m=>m.finalPosition.equals(l.position)))return!1}return!0}}class R{}var I=(i=>(i[i.WHITE=0]="WHITE",i[i.BLACK=1]="BLACK",i))(I||{});const qe=i=>0<=i.x&&i.x<8&&0<=i.y&&i.y<8,_e=(i,e,t,o,l,a,n)=>{const s=[];let c=i.add(e,t),m=0;for(;qe(c)&&m<o;){const b=l.find(u=>u.position.equals(c));if(b!==void 0){n&&b.color!=a&&s.push(c);break}s.push(c),c=c.add(e,t),m++}return s},Le=i=>{const e=[];for(const t of i)e.some(o=>o.x===t.x&&o.y===t.y)||e.push(t);return e},F=(i,e,t,o,l,a,n)=>{let s=[];return[[e,t],[e,-t],[-e,t],[-e,-t],[t,e],[t,-e],[-t,e],[-t,-e]].forEach(m=>{s=s.concat(_e(i,...m,o,l,a,n))}),Le(s)};class Ce extends R{constructor(){super(...arguments);C(this,"id","k")}moves(t,o,l){return F(t,1,1,1,o,l,!0).concat(F(t,1,0,1,o,l,!0))}}const Y=new Ce;class xe extends R{constructor(){super(...arguments);C(this,"id","r")}moves(t,o,l){return F(t,1,0,1/0,o,l,!0)}}const z=new xe;class Be extends R{constructor(){super(...arguments);C(this,"id","n")}moves(t,o,l){return F(t,2,1,1,o,l,!0)}}const oe=new Be;class Ke extends R{constructor(){super(...arguments);C(this,"id","b")}moves(t,o,l){return F(t,1,1,1/0,o,l,!0)}}const J=new Ke;class De extends R{constructor(){super(...arguments);C(this,"id","q")}moves(t,o,l){return J.moves(t,o,l).concat(z.moves(t,o,l))}}const Ee=new De,Re=(i,e,t)=>i.filter(o=>e.some(l=>l.position.equals(o)&&l.color!=t));class Ne extends R{constructor(){super(...arguments);C(this,"id","p")}moves(t,o,l){return _e(t,0,l===0?-1:1,t.y===(l===0?6:1)?2:1,o,l,!1).concat(Re(l===0?[t.add(-1,-1),t.add(1,-1)]:[t.add(-1,1),t.add(1,1)],o,l))}}const le=new Ne;class B{constructor(e,t,o){this.type=e,this.color=t,this.position=o}moves(e){return this.type.moves(this.position,e.pieces,this.color)}doubleMoves(e,t){const o=t.flatMap(s=>{var u;const c=(u=e.pieceAt(s))==null?void 0:u.position,m=e.copyWithMove(this.position,s);return console.log(s),m.pieceAt(s).moves(m).map(p=>({finalPosition:p,takes:c}))}),l=[];o.forEach(s=>{l.some(c=>s.finalPosition.equals(c.finalPosition)&&(s.takes===void 0&&c.takes===void 0||s.takes!==void 0&&c.takes!==void 0&&s.takes.equals(c.takes)))||l.push(s)});const a=[],n=[];for(const s of l){const c=a.find(m=>m.equals(s.finalPosition));c===void 0?(a.push(s.finalPosition),n.push([s])):n[a.indexOf(c)].push(s)}return n.filter(s=>s.filter(c=>c.takes!==void 0).length<=1).flat().filter(s=>!t.some(c=>c.equals(s.finalPosition))).filter(s=>!s.finalPosition.equals(this.position))}copy(){return new B(this.type,this.color,this.position.copy())}}const N=[Y,z,oe,Ee,J,le];function me(i,e,t){const o=i.slice();return o[14]=e[t],o[16]=t,o}function Oe(i){let e,t,o,l,a,n,s,c,m,b;return{c(){e=M("div"),t=M("img"),l=G(),a=M("div"),n=ie("svg"),s=ie("circle"),c=ie("circle"),this.h()},l(u){e=q(u,"DIV",{class:!0});var p=x(e);t=q(p,"IMG",{src:!0,alt:!0}),l=Z(p),a=q(p,"DIV",{class:!0});var k=x(a);n=ne(k,"svg",{viewBox:!0});var y=x(n);s=ne(y,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),x(s).forEach(A),c=ne(y,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),x(c).forEach(A),y.forEach(A),k.forEach(A),p.forEach(A),this.h()},h(){O(t.src,o=D+"/images/search.svg")||w(t,"src",o),w(t,"alt","A magnifying glass."),w(s,"cx","0.5"),w(s,"cy","0.5"),w(s,"r","0.4"),w(s,"fill","black"),w(c,"cx","0.5"),w(c,"cy","0.5"),w(c,"r",i[5]),w(c,"fill","white"),w(n,"viewBox","0 0 1 1"),w(a,"class","turn-indicator"),w(e,"class","toolbar")},m(u,p){K(u,e,p),W(e,t),W(e,l),W(e,a),W(a,n),W(n,s),W(n,c),m||(b=[H(t,"mousedown",i[8]),H(t,"keydown",i[8]),H(a,"click",i[6]),H(a,"keydown",i[6])],m=!0)},p(u,p){p&32&&w(c,"r",u[5])},d(u){u&&A(e),m=!1,ce(b)}}}function Fe(i){let e,t,o,l,a,n,s,c,m,b=N,u=[];for(let p=0;p<b.length;p+=1)u[p]=ye(me(i,b,p));return{c(){e=M("div"),t=M("img"),l=G(),a=M("img"),s=G();for(let p=0;p<u.length;p+=1)u[p].c();this.h()},l(p){e=q(p,"DIV",{class:!0});var k=x(e);t=q(k,"IMG",{src:!0,alt:!0}),l=Z(k),a=q(k,"IMG",{src:!0,alt:!0}),s=Z(k);for(let y=0;y<u.length;y+=1)u[y].l(k);k.forEach(A),this.h()},h(){O(t.src,o=D+"/images/edit.svg")||w(t,"src",o),w(t,"alt","A pencil."),O(a.src,n=D+"/images/palette.svg")||w(a,"src",n),w(a,"alt","A color palette."),w(e,"class","toolbar")},m(p,k){K(p,e,k),W(e,t),W(e,l),W(e,a),W(e,s);for(let y=0;y<u.length;y+=1)u[y].m(e,null);c||(m=[H(t,"mousedown",i[8]),H(t,"keydown",i[8]),H(a,"mousedown",i[7]),H(a,"keydown",i[7])],c=!0)},p(p,k){if(k&24){b=N;let y;for(y=0;y<b.length;y+=1){const V=me(p,b,y);u[y]?u[y].p(V,k):(u[y]=ye(V),u[y].c(),u[y].m(e,null))}for(;y<u.length;y+=1)u[y].d(1);u.length=b.length}},d(p){p&&A(e),Me(u,p),c=!1,ce(m)}}}function ye(i){let e,t,o,l;function a(){return i[11](i[16])}function n(){return i[12](i[16])}return{c(){e=M("img"),this.h()},l(s){e=q(s,"IMG",{src:!0,alt:!0}),this.h()},h(){O(e.src,t=`${D}/images/${i[4]===I.WHITE?"w":"b"}${i[14].id}.png`)||w(e,"src",t),w(e,"alt",""),ge(e,"selected",i[16]===i[3])},m(s,c){K(s,e,c),o||(l=[H(e,"mousedown",a),H(e,"keydown",n)],o=!0)},p(s,c){i=s,c&16&&!O(e.src,t=`${D}/images/${i[4]===I.WHITE?"w":"b"}${i[14].id}.png`)&&w(e,"src",t),c&8&&ge(e,"selected",i[16]===i[3])},d(s){s&&A(e),o=!1,ce(l)}}}function Ye(i){let e,t,o;function l(s,c){return s[2]===s[1].EDIT?Fe:Oe}let a=l(i),n=a(i);return{c(){e=M("canvas"),t=G(),n.c(),o=pe()},l(s){e=q(s,"CANVAS",{}),x(e).forEach(A),t=Z(s),n.l(s),o=pe()},m(s,c){K(s,e,c),i[10](e),K(s,t,c),n.m(s,c),K(s,o,c)},p(s,[c]){a===(a=l(s))&&n?n.p(s,c):(n.d(1),n=a(s),n&&(n.c(),n.m(o.parentNode,o)))},i:he,o:he,d(s){s&&A(e),i[10](null),s&&A(t),n.d(s),s&&A(o)}}}function Ve(i,e,t){let o,l;var a;(function(_){_[_.WHITE_FIRST=0]="WHITE_FIRST",_[_.WHITE_SECOND=1]="WHITE_SECOND",_[_.BLACK=2]="BLACK"})(a||(a={}));let n=a.WHITE_FIRST;const s=()=>{t(9,n++,n),t(9,n%=3)};We(()=>{const _=window.innerHeight,f=_/8,ae=(r,g)=>{const h=new Image;return h.src=`${D}/images/${g===I.WHITE?"w":"b"}${r}.png`,h},Ie=Object.assign({},...N.map(r=>({[r.id]:ae(r.id,I.WHITE)}))),ve=Object.assign({},...N.map(r=>({[r.id]:ae(r.id,I.BLACK)}))),fe=r=>(r.color===I.WHITE?Ie:ve)[r.type.id];t(0,l.width=_,l),t(0,l.height=_,l);const v=l.getContext("2d");v.fillStyle="#b58863",v.fillRect(0,0,_,_),v.fillStyle="#f0d9b5";for(let r=0;r<8;r++)for(let g=r%2;g<8;g+=2)v.fillRect(r*f,g*f,f,f);const Q=(r,g,h,E)=>{v.fillStyle=E,v.beginPath(),v.ellipse(r*f+f/2,g*f+f/2,h,h,0,0,2*Math.PI),v.fill()},be=(r,g,h,E)=>{r.forEach(d=>{Q(d.x,d.y,f/5,(d.x+d.y)%2==1?"#6e533c":"#92846e"),Q(d.x,d.y,f/10,(d.x+d.y)%2==1?"#b58863":"#f0d9b5")}),g.forEach(d=>{Q(d.x,d.y,f/5,(d.x+d.y)%2==1?"#6e533c":"#92846e")}),h.forEach(d=>{v.fillStyle=(d.x+d.y)%2==1?"#6e533c":"#92846e",v.fillRect(d.x*f,d.y*f,f,f),v.fillStyle=(d.x+d.y)%2==1?"#b58863":"#f0d9b5",v.fillRect(d.x*f+f/15,d.y*f+f/15,f-2*f/15,f-2*f/15)}),E.forEach(d=>{v.fillStyle=(d.x+d.y)%2==1?"#6e533c":"#92846e",v.fillRect(d.x*f,d.y*f,f,f)})},ue=(r,g)=>[...Array(g-r).keys()].map(h=>h+r),T=new re([...ue(0,8).map(r=>new B(le,I.BLACK,new S(r,1))),...[z,oe,J,Ee,Y,J,oe,z].map((r,g)=>new B(r,I.BLACK,new S(g,0))),...ue(2,6).map(r=>new B(le,I.WHITE,new S(r,6))),new B(Y,I.WHITE,new S(4,7))]);let P,L=[],X=[],U=[],$=[],ee=[],te=[];const de=()=>{requestAnimationFrame(de),v.fillStyle="#b58863",v.fillRect(0,0,_,_),v.fillStyle="#f0d9b5";for(let r=0;r<8;r++)for(let g=r%2;g<8;g+=2)v.fillRect(r*f,g*f,f,f);P!==void 0&&be(U,$,ee,te),T.pieces.forEach(r=>{r!==P&&v.drawImage(fe(r),r.position.x*f,r.position.y*f,f,f)}),P!==void 0&&v.drawImage(fe(P),j.x-f/2,j.y-f/2,f,f)};de();const j=new S(0,0),se=r=>{const g=[],h=[];return r.forEach(E=>{T.pieces.some(d=>d.position.equals(E))?h.push(E):g.push(E)}),[g,h]};l.addEventListener("mousedown",r=>{if(r.button===0){const g=new S(Math.floor(r.offsetX/f),Math.floor(r.offsetY/f)),h=T.pieceAt(g);h!==void 0&&(h.color===I.WHITE&&(n===a.WHITE_FIRST||n===a.WHITE_SECOND)||h.color===I.BLACK&&n===a.BLACK)?(P=h,n===a.WHITE_SECOND||n===a.BLACK?(L=h.moves(T).filter(E=>T.copyWithMove(h.position,E).legalState(n===a.WHITE_FIRST||n===a.WHITE_SECOND?I.WHITE:I.BLACK)),X=[],[$,te]=se(L),[U,ee]=[[],[]]):(L=h.moves(T),X=h.doubleMoves(T,L).filter(E=>T.copyWithMove(h.position,E.finalPosition).legalState(n===a.WHITE_FIRST||n===a.WHITE_SECOND?I.WHITE:I.BLACK)),[U,ee]=se(L),[$,te]=se(X.map(E=>E.finalPosition)))):m===c.EDIT&&T.pieces.push(new B(N[b],u,g))}else r.button===2&&(P=void 0)}),l.addEventListener("mouseup",r=>{if(P!==void 0){const g=new S(Math.floor(r.offsetX/f),Math.floor(r.offsetY/f));if(n===a.WHITE_SECOND||n===a.BLACK){const h=L.find(E=>E.equals(g));h!==void 0&&(T.move(P.position,h),t(9,n++,n))}else{const h=L.find(d=>d.equals(g)),E=X.find(d=>d.finalPosition.equals(g));h!==void 0?(T.move(P.position,h),t(9,n++,n)):E!==void 0&&(E.takes!==void 0?(T.move(P.position,E.takes),T.move(E.takes,E.finalPosition)):T.move(P.position,E.finalPosition),t(9,n+=2))}t(9,n%=3),P=void 0}}),l.addEventListener("contextmenu",r=>r.preventDefault()),document.addEventListener("mousemove",r=>{j.x=r.offsetX,j.y=r.offsetY}),document.addEventListener("keydown",r=>{})});var c;(function(_){_[_.ANALYSIS=0]="ANALYSIS",_[_.EDIT=1]="EDIT"})(c||(c={}));let m=c.ANALYSIS,b=0,u=I.WHITE;const p=()=>{t(4,u++,u),t(4,u%=2)},k=()=>{t(2,m++,m),t(2,m%=2)};function y(_){He[_?"unshift":"push"](()=>{l=_,t(0,l)})}const V=_=>{t(3,b=_)},we=_=>{t(3,b=_)};return i.$$.update=()=>{i.$$.dirty&512&&t(5,o=[.4,.2,0][n])},[l,c,m,b,u,o,s,p,k,n,y,V,we]}class Ze extends Ae{constructor(e){super(),Pe(this,e,Ve,Ye,Se,{})}}export{Ze as default};
